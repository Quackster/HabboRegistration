(function(ot){"use strict";const wt={figure:"",gender:"U",userHasClub:!1,showClubSelections:!0,showRotationArrows:!1,assetsPath:"",localization:{randomize:"Randomize",boy:"Boy",girl:"Girl"}},rt=495,nt=435,G=400,Y=64,B=106,X=68,bt=2,Ct=323,Ft=303,J=70,K=307,Q=46,At=305,Tt=80,Mt=85,vt=180,_t=4,R="hd",Rt=[0,1,2,3,2,1,0,7],P=[{id:"body",type:"gender",items:["male","female"]},{id:"head",type:"part",items:["hr","ha","he","ea","fa"]},{id:"chest",type:"part",items:["ch","ca"]},{id:"legs",type:"part",items:["lg","sh","wa"]}];class Pt{constructor(t,e,s,i,o,r,c,n,h){this.setId=t,this.setType=e,this.paletteId=s,this.gender=i,this.clubOnly=r,this.selectable=c,this.colorable=n,this.parts=o,this.hiddenLayers=h}getSetId(){return this.setId}getSetType(){return this.setType}getPaletteId(){return this.paletteId}getGender(){return this.gender}isClubOnly(){return this.clubOnly}isSelectable(){return this.selectable}isColorable(){return this.colorable}getParts(){return this.parts}getHiddenLayers(){return this.hiddenLayers}}class Dt{constructor(t,e,s,i,o,r){this.paletteId=t,this.color=e,this.id=s,this.index=i,this.clubOnly=o,this.selectable=r}getPaletteId(){return this.paletteId}getColorStr(){return this.color}getID(){return this.id}getIndex(){return this.index}isClubOnly(){return this.clubOnly}isSelectable(){return this.selectable}}class Bt{constructor(t,e,s){this.partId=t,this.partType=e,this.colorable=s}getPartId(){return this.partId}getPartType(){return this.partType}isPartColorable(){return this.colorable}}const N=class N{constructor(){this.setTypeArr=[],this.setArr=[],this.paletteArr=[],this.loaded=!1}static getInstance(){return N.instance||(N.instance=new N),N.instance}async loadFromUrl(t){const e=await fetch(t);if(!e.ok){console.error(`[FigureData] Failed to load: ${t} (${e.status})`);return}const s=await e.text(),o=new DOMParser().parseFromString(s,"text/xml");this.parseXml(o),console.log(`[FigureData] Loaded ${this.setArr.length} sets, ${this.paletteArr.length} colors, ${this.setTypeArr.length} set types`)}parseXml(t){const e=t.querySelector("figuredata");if(!e)return;const s=e.querySelector("sets");s&&this.parseSets(s);const i=e.querySelector("colors");i&&this.parseColors(i),this.loaded=!0}isLoaded(){return this.loaded}getSetTypes(){return this.setTypeArr}getSetForId(t){for(const e of this.setArr)if(e.getSetId()===t)return e;return null}getSetsForSetType(t,e,s=!0,i=!0){const o=[];for(const r of this.setArr)i&&!r.isSelectable()||r.getSetType()===t&&(r.getGender()!==e&&r.getGender()!=="U"||!s&&r.isClubOnly()||o.push(r));return o}getPaletteIdForSetType(t){for(const e of this.setArr)if(e.getSetType()===t)return e.getPaletteId();return 1}getPartsForSetId(t){for(const e of this.setArr)if(e.getSetId()===t)return e.getParts();return[]}getColorsForPaletteId(t,e=!0,s=!0){const i=[];for(const o of this.paletteArr)s&&!o.isSelectable()||o.getPaletteId()===t&&(!e&&o.isClubOnly()||i.push(o));return i}getColorData(t){for(const e of this.paletteArr)if(e.getID()===t)return e;return null}isSetTypeMandatory(t){for(const[e,s]of this.setTypeArr)if(e===t)return s;return!1}parseColors(t){this.paletteArr=[];const e=t.querySelectorAll("palette");for(const s of e){const i=parseInt(s.getAttribute("id")||"0",10),o=s.querySelectorAll("color");for(const r of o){const c=parseInt(r.getAttribute("id")||"0",10),n=parseInt(r.getAttribute("index")||"0",10),h=r.getAttribute("club")==="1",a=r.getAttribute("selectable")==="1",l=r.textContent||"FFFFFF";this.paletteArr.push(new Dt(i,l,c,n,h,a))}}}parseSets(t){this.setArr=[],this.setTypeArr=[];const e=t.querySelectorAll("settype");for(const s of e){const i=s.getAttribute("type")||"",o=parseInt(s.getAttribute("paletteid")||"0",10),r=s.getAttribute("mandatory")==="1";this.setTypeArr.push([i,r]);const c=s.querySelectorAll("set");for(const n of c){const h=parseInt(n.getAttribute("id")||"0",10),a=n.getAttribute("gender")||"U",l=n.getAttribute("club")==="1",d=n.getAttribute("colorable")==="1",f=n.getAttribute("selectable"),u=f===null?!0:f==="1",p=[],I=n.querySelectorAll(":scope > part");for(const b of I){const T=parseInt(b.getAttribute("id")||"0",10),F=b.getAttribute("type")||"",M=b.getAttribute("colorable")==="1";p.push(new Bt(T,F,M))}const C=[],m=n.querySelector("hiddenlayers");if(m){const b=m.querySelectorAll("layer");for(const T of b){const F=T.getAttribute("parttype")||"";C.push(F)}}this.setArr.push(new Pt(h,i,o,a,p,l,u,d,C))}}}};N.instance=null;let w=N;const x=class x{constructor(){this.drawOrderData={},this.loaded=!1}static getInstance(){return x.instance||(x.instance=new x),x.instance}async loadFromUrl(t){const e=await fetch(t);if(!e.ok){console.error(`[DrawOrder] Failed to load: ${t} (${e.status})`);return}const s=await e.text(),o=new DOMParser().parseFromString(s,"text/xml");this.parseXml(o);const r=Object.keys(this.drawOrderData).length;console.log(`[DrawOrder] Loaded ${r} actions`)}parseXml(t){const e=t.querySelectorAll("action");for(const s of e){const i=s.getAttribute("id")||"std";this.drawOrderData[i]={};const o=s.querySelectorAll("direction");for(const r of o){const c=r.getAttribute("id")||"0",n=[],h=r.querySelectorAll("part");for(const a of h){const l=a.getAttribute("set-type")||"";n.push(l)}this.drawOrderData[i][c]=n}}this.loaded=!0}isLoaded(){return this.loaded}getOrderArray(t,e){const i=this.drawOrderData["std"];if(!i)return[];const o=i[String(t)];return o||[]}};x.instance=null;let $=x;const L=class L{constructor(){this.nameToFileId=new Map,this.imageOffsets=new Map,this.loaded=!1}static getInstance(){return L.instance||(L.instance=new L),L.instance}async loadFromUrl(t){const e=await fetch(t);if(!e.ok){console.error(`[SymbolMap] Failed to load symbols CSV: ${t} (${e.status})`);return}const s=await e.text();this.parseCsv(s),console.log(`[SymbolMap] Loaded ${this.nameToFileId.size} symbol entries`)}async loadOffsetsFromUrl(t){const e=await fetch(t);if(!e.ok){console.error(`[SymbolMap] Failed to load offsets CSV: ${t} (${e.status})`);return}const s=await e.text();this.parseOffsets(s),console.log(`[SymbolMap] Loaded ${this.imageOffsets.size} sprite offsets`)}parseCsv(t){const e=t.trim().split(`
`);for(const s of e){const i=s.trim();if(!i)continue;const[o,r]=i.split(";");if(!r)continue;const n=parseInt(o,10)-2;this.nameToFileId.set(r.trim(),n)}this.loaded=!0}parseOffsets(t){const e=t.trim().split(`
`);for(const s of e){const i=s.trim();if(!i)continue;const o=i.split(";");if(o.length<3)continue;const r=parseInt(o[0],10),c=parseFloat(o[1]),n=parseFloat(o[2]);this.imageOffsets.set(r,{x:c,y:n})}}isLoaded(){return this.loaded}getFileIdForName(t){return this.nameToFileId.get(t)??null}getFilenameForName(t){const e=this.getFileIdForName(t);return e===null?null:`${e}.png`}getOffsetForImageId(t){return this.imageOffsets.get(t)??{x:0,y:0}}getOffsetForName(t){const e=this.getFileIdForName(t);return e===null?{x:0,y:0}:this.getOffsetForImageId(e)}getAllNames(){return Array.from(this.nameToFileId.keys())}};L.instance=null;let O=L;class Ot{constructor(t,e,s){this.setType=t,this.setId=e,this.colorId=s}setValues(t,e,s){this.setType=t,this.setId=e,this.colorId=s}getSetType(){return this.setType}getSetId(){return this.setId}getColorId(){return this.colorId}}const at=".",tt="-",Et=[["M","hr",97],["M","ha",40],["M","he",15],["M","ea",30],["M","fa",15],["M","ca",10],["M","wa",40],["M","sh",95],["F","hr",100],["F","ha",40],["F","he",25],["F","ea",15],["F","fa",8],["F","ca",15],["F","wa",40],["F","sh",95]];class E{constructor(t,e){this.figureData=[],this.gender="M",t&&this.setGender(t),e&&this.parseFigureString(e)}setGender(t){switch(t.toLowerCase()){case"m":case"male":this.gender="M";break;case"f":case"female":this.gender="F";break;default:this.gender=t.toUpperCase()}}getGender(){return this.gender}getFigureData(){return this.figureData}parseFigureString(t){if(this.figureData=[],!t||t.length===0)return!1;const e=w.getInstance(),s=t.split(at);let i=!0;for(const r of s){const c=r.split(tt);if(c.length!==3)return this.figureData=[],!1;let n=c[0],h=parseInt(c[1],10),a=parseInt(c[2],10)||0;const l=e.getSetForId(h);if(l&&l.isSelectable()){if(l.isColorable()&&a>0){const d=e.getColorData(a);if(d&&!(d.getPaletteId()===l.getPaletteId())){const u=e.getColorsForPaletteId(l.getPaletteId(),!1,!0);u.length>0&&(a=u[0].getID(),i=!1)}}}else{const d=e.getSetsForSetType(n,this.gender,!1,!0);if(d.length>0){const f=d[0];h=f.getSetId();const u=e.getColorsForPaletteId(f.getPaletteId(),!1,!0);u.length>0&&(a=u[0].getID()),i=!1}}this.setSetItem(n,h,a)}return this.validateAndFixFigure()&&i}getFigureString(){const t=w.getInstance(),e=[];for(const s of this.figureData){const i=s.getSetType(),o=s.getSetId(),r=s.getColorId(),c=t.getSetForId(o);let n="";c&&c.isColorable()&&(n=String(r)),e.push(`${i}${tt}${o}${tt}${n}`)}return e.join(at)}setSetItem(t,e,s){for(const i of this.figureData)if(i.getSetType()===t){i.setValues(t,e,s);return}this.figureData.push(new Ot(t,e,s))}removeSetItemByType(t){const e=this.figureData.findIndex(s=>s.getSetType()===t);e!==-1&&this.figureData.splice(e,1)}setSetTypeColor(t,e){for(const s of this.figureData)s.getSetType()===t&&s.setValues(t,s.getSetId(),e)}getSetItemById(t){for(const e of this.figureData)if(e.getSetId()===t)return e;return null}getSetItemByType(t){for(const e of this.figureData)if(e.getSetType()===t)return e;return null}getSetTypeColorId(t){const e=this.getSetItemByType(t);return e?e.getColorId():-1}getClubColors(){const t=w.getInstance(),e=[];for(const s of this.figureData){const i=t.getColorData(s.getColorId());i&&i.isClubOnly()&&e.push({colorData:i})}return e}getClubSets(){const t=w.getInstance(),e=[];for(const s of this.figureData){const i=t.getSetForId(s.getSetId());i&&i.isClubOnly()&&e.push({setData:i})}return e}randomizeFigure(t,e=!1){this.figureData=[];let s=t;t==="U"&&(s=Math.random()<.5?"M":"F"),this.setGender(s);const i=w.getInstance(),o=i.getSetTypes();for(const[r,c]of o){const n=this.getSetTypeProbability(r),h=Math.floor(Math.random()*100)<=n;if(c||h){const a=i.getSetsForSetType(r,this.gender,e,!0);if(a.length===0)continue;const l=a[Math.floor(Math.random()*a.length)],d=l.getPaletteId();let f=i.getColorsForPaletteId(d,e,!0);if(r==="hd"&&(f=f.slice(0,10)),f.length===0)continue;const u=Math.floor(Math.random()*f.length),p=f[u].getID();this.setSetItem(r,l.getSetId(),p)}}}getSetTypeProbability(t){for(const[e,s,i]of Et)if(e===this.gender&&s===t)return i;return 30}validateAndFixFigure(){const t=w.getInstance(),e=[];let s=!0;for(const i of this.figureData){const o=i.getSetType(),r=i.getSetId(),c=t.getSetForId(r);if(!c||!c.isSelectable()){const n=t.getSetsForSetType(o,this.gender,!1,!0);n.length>0&&e.push({setType:n[0].getSetType(),setId:n[0].getSetId(),paletteId:n[0].getPaletteId()})}else{const n=i.getColorId(),h=t.getColorData(n);if(h&&!h.isSelectable()){const a=h.getPaletteId(),l=t.getColorsForPaletteId(a,!1,!0);l.length>0&&(this.setSetItem(o,r,l[0].getID()),s=!1)}}}for(const i of e){const o=t.getColorsForPaletteId(i.paletteId,!1,!0),r=o.length>0?o[0].getID():0;this.setSetItem(i.setType,i.setId,r),s=!1}return s}}class Nt{constructor(){this.listeners=new Map}on(t,e){this.listeners.has(t)||this.listeners.set(t,[]),this.listeners.get(t).push(e)}off(t,e){const s=this.listeners.get(t);if(s){const i=s.indexOf(e);i!==-1&&s.splice(i,1)}}emit(t,e){const s=this.listeners.get(t);if(s)for(const i of s)i(e)}}class xt{constructor(t,e){this.mainMenuIndex=0,this.subMenuIndex=0,this.currentSetType=R,this.bodyPartPage=0,this.colorPage=0,this.avatarDirection=_t,this.userHasClub=t,this.showClubSelections=e,this.figure=new E,this.storedMaleFigure=new E("M"),this.storedFemaleFigure=new E("F"),this.eventBus=new Nt}}class Lt{constructor(t){this.spriteCache=new Map,this.uiCache=new Map,this.assetsPath=t.endsWith("/")?t:t+"/"}loadImage(t){return new Promise((e,s)=>{const i=new Image;i.onload=()=>e(i),i.onerror=()=>s(new Error(`Failed to load: ${t}`)),i.src=t})}async loadSprite(t){if(this.spriteCache.has(t))return this.spriteCache.get(t);const e=await this.loadImage(`${this.assetsPath}sprites/${t}`);return this.spriteCache.set(t,e),e}async loadUIAsset(t){if(this.uiCache.has(t))return this.uiCache.get(t);const e=await this.loadImage(`${this.assetsPath}ui/${t}`);return this.uiCache.set(t,e),e}getSprite(t){return this.spriteCache.get(t)||null}getUIAsset(t){return this.uiCache.get(t)||null}async preloadAllSprites(t,e){let s=0;const i=t.length,o=t.map(async r=>{try{await this.loadSprite(r)}catch{}s++,e==null||e(s,i)});await Promise.all(o)}async preloadUIAssets(t,e){let s=0;const i=t.length,o=t.map(async r=>{try{await this.loadUIAsset(r)}catch{}s++,e==null||e(s,i)});await Promise.all(o)}}function lt(g,t,e,s,i,o,r,c,n){const h=t.width,a=t.height;if(e===255&&s===255&&i===255){g.drawImage(t,o,r,h,a);return}const l=document.createElement("canvas");l.width=h,l.height=a;const d=l.getContext("2d");d.drawImage(t,0,0,h,a);const f=d.getImageData(0,0,h,a),u=f.data,p=e/255,I=s/255,C=i/255;for(let m=0;m<u.length;m+=4)u[m]=Math.round(u[m]*p),u[m+1]=Math.round(u[m+1]*I),u[m+2]=Math.round(u[m+2]*C);d.putImageData(f,0,0),g.drawImage(l,o,r)}function et(g){const t=g.replace("#",""),e=parseInt(t.substring(0,2),16)||0,s=parseInt(t.substring(2,4),16)||0,i=parseInt(t.substring(4,6),16)||0;return[e,s,i]}const $t=98;class Ht{constructor(t){this.debugLogDone=!1,this.spriteLoader=t}collectParts(t){const e=w.getInstance(),s=new Map,i=[];for(const o of t.getFigureData()){const r=o.getSetId(),c=o.getColorId(),n=e.getColorData(c),h=n?n.getColorStr():"FFFFFF",a=e.getSetForId(r);if(a){i.push(...a.getHiddenLayers());for(const l of e.getPartsForSetId(r)){const d=l.getPartType();s.has(d)||s.set(d,[]),s.get(d).push({partType:d,partId:l.getPartId(),colorStr:h,colorable:l.isPartColorable()})}}}return s.has("hrb")&&!i.includes("hrb")&&i.push("hr"),{partsMap:s,hiddenLayers:i}}drawAvatarToCanvas(t,e,s,i,o,r){const c=$.getInstance(),n=O.getInstance(),h=Rt[s],a=s!==h;let l=c.getOrderArray(h,"std");l.length===0&&(l=["li","lh","ls","bd","sh","lg","ch","wa","hd","fc","ey","hr","hrb","ri","rh","rs","ea","ca","fa","ha","he"]);const{partsMap:d,hiddenLayers:f}=this.collectParts(e),u=!this.debugLogDone;u&&(this.debugLogDone=!0,console.log(`[AvatarRenderer] Direction=${s}, flipDir=${h}, needsFlip=${a}`),console.log(`[AvatarRenderer] Draw order (${l.length} layers):`,l.join(", ")),console.log("[AvatarRenderer] Parts available:",Array.from(d.keys()).join(", ")),console.log("[AvatarRenderer] Hidden layers:",f.join(", ")||"(none)"));const p=document.createElement("canvas");p.width=Y,p.height=B;const I=p.getContext("2d");let C=0;for(const b of l){if(f.includes(b))continue;const T=d.get(b);if(T)for(const F of T){const M=`h_std_${F.partType}_${F.partId}_${h}_0`,D=n.getFilenameForName(M);if(!D){u&&console.warn(`[AvatarRenderer] No sprite found for: ${M}`);continue}const y=this.spriteLoader.getSprite(D);if(!y){u&&console.warn(`[AvatarRenderer] Sprite not loaded: ${D} (${M})`);continue}const v=n.getOffsetForName(M);let[H,k,U]=[255,255,255];F.partType!=="ey"&&F.colorable&&([H,k,U]=et(F.colorStr));const _=v.x,S=v.y+$t;u&&console.log(`[AvatarRenderer]   ${F.partType}:${F.partId} -> ${D} offset=(${v.x}, ${v.y}) draw=(${_}, ${S}) img=${y.width}x${y.height} color=${F.colorStr} tint=(${H},${k},${U})`),lt(I,y,H,k,U,_,S),C++}}u&&(console.log(`[AvatarRenderer] Rendered ${C} sprites to ${Y}x${B} offscreen canvas`),console.log(`[AvatarRenderer] Drawing at screen (${i}, ${o}) scale=${r} -> ${Y*r}x${B*r}`));const m=t.imageSmoothingEnabled;if(t.imageSmoothingEnabled=!1,a){const b=document.createElement("canvas");b.width=X,b.height=B;const T=b.getContext("2d");T.translate(X,0),T.scale(-1,1),T.drawImage(p,0,0),t.drawImage(b,0,0,X,B,i,o,X*r,B*r)}else t.drawImage(p,i,o,Y*r,B*r);t.imageSmoothingEnabled=m}}const kt={hr:83,ha:82,he:82,ea:75,fa:72,hd:78,ch:53,ca:53,wa:43,lg:32,sh:23},Ut=-95,Gt={hr:1,ha:0,he:0,ea:-3,fa:-4,hd:0,ch:0,ca:0,wa:0,lg:0,sh:-2},Yt=-9,Xt=98,W=45;class Wt{constructor(t){this.spriteLoader=t}renderIcon(t,e){const s=document.createElement("canvas");s.width=W,s.height=W;const i=s.getContext("2d"),o=O.getInstance(),r=$.getInstance(),c=t.getSetType(),n=t.getParts(),h=2,a=r.getOrderArray(h,"std"),l=new Set(["bd","lh","rh"]),d=[];for(const p of n){const I=p.getPartType();if(l.has(I))continue;const C=a.indexOf(I);d.push({partType:I,partId:p.getPartId(),colorable:p.isPartColorable(),depth:C>=0?C:999})}d.sort((p,I)=>p.depth-I.depth);const f=(kt[c]??50)+Ut,u=(Gt[c]??0)+Yt;i.save(),i.beginPath(),i.rect(0,0,W,W),i.clip();for(const p of d){const I=`h_std_${p.partType}_${p.partId}_${h}_0`,C=o.getFilenameForName(I);if(!C)continue;const m=this.spriteLoader.getSprite(C);if(!m)continue;const b=o.getOffsetForName(I);let[T,F,M]=[255,255,255];p.partType!=="ey"&&p.colorable&&([T,F,M]=et(e));const D=b.x+u,y=b.y+Xt+f;lt(i,m,T,F,M,D,y)}return i.restore(),s}}class zt{constructor(t,e,s){this.drawCallback=null,this.animationFrameId=null,this.needsRedraw=!0,this.hitRegions=e,this.canvasWidth=s,this.canvas=document.createElement("canvas"),this.canvas.width=s,this.canvas.height=G,this.canvas.style.display="block",this.ctx=this.canvas.getContext("2d"),t.appendChild(this.canvas),this.setupEventListeners()}setDrawCallback(t){this.drawCallback=t}requestRedraw(){this.needsRedraw=!0}startRenderLoop(){const t=()=>{var e;this.needsRedraw&&(this.needsRedraw=!1,this.clear(),(e=this.drawCallback)==null||e.call(this)),this.animationFrameId=requestAnimationFrame(t)};this.animationFrameId=requestAnimationFrame(t)}startContinuousRender(){const t=()=>{var e;this.clear(),(e=this.drawCallback)==null||e.call(this),this.animationFrameId=requestAnimationFrame(t)};this.animationFrameId=requestAnimationFrame(t)}stopRenderLoop(){this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}clear(){this.ctx.fillStyle="#FFFFFF",this.ctx.fillRect(0,0,this.canvasWidth,G)}getCanvasCoords(t){const e=this.canvas.getBoundingClientRect(),s=this.canvasWidth/e.width,i=G/e.height;return{x:(t.clientX-e.left)*s,y:(t.clientY-e.top)*i}}setupEventListeners(){this.canvas.addEventListener("click",t=>{const{x:e,y:s}=this.getCanvasCoords(t);this.hitRegions.handleClick(e,s)&&this.requestRedraw()}),this.canvas.addEventListener("mousemove",t=>{const{x:e,y:s}=this.getCanvasCoords(t),i=this.hitRegions.getCursorAt(e,s);this.canvas.style.cursor=i})}}class Vt{constructor(){this.regions=[]}clear(){this.regions=[]}add(t){this.regions.push(t)}remove(t){this.regions=this.regions.filter(e=>e.id!==t)}removeByPrefix(t){this.regions=this.regions.filter(e=>!e.id.startsWith(t))}hitTest(t,e){for(let s=this.regions.length-1;s>=0;s--){const i=this.regions[s];if(t>=i.x&&t<i.x+i.width&&e>=i.y&&e<i.y+i.height)return i}return null}getCursorAt(t,e){const s=this.hitTest(t,e);return(s==null?void 0:s.cursor)||"default"}handleClick(t,e){const s=this.hitTest(t,e);return s!=null&&s.onClick?(s.onClick(),!0):!1}}const ct=13,st={prevIconBg:14,prevIconMask:17,randomizeButtonBg:139,hcTagSmall:22,rotateArrowLeft:25,rotateArrowRight:28,partArrowLeft:31,partArrowLeftReactive:34,partArrowRight:37,partArrowRightReactive:40,partSelected:43,mainMenuMainSelectedBg:46,mainMenuSubSelectedBg:49,arrowSmallLeft:52,arrowSmallLeftReactive:55,arrowSmallRightReactive:58,arrowSmallRight:61,mainMenuMainUnselectedBg:64,mainMenuMain_body_Selected:67,mainMenuMain_body_Unselected:70,mainMenuMain_chest_Selected:73,mainMenuMain_chest_Unselected:76,mainMenuMain_legs_Unselected:79,mainMenuMain_legs_Selected:82,mainMenuMain_head_Unselected:85,mainMenuMain_head_Selected:88,mainMenuSub_sh:91,mainMenuSub_male:94,mainMenuSub_lg:97,mainMenuSub_female:100,mainMenuSub_ha:103,mainMenuSub_hr:106,mainMenuSub_ea:109,mainMenuSub_wa:112,mainMenuSub_ca:115,mainMenuSub_he:118,mainMenuSub_fa:121,mainMenuSub_ch:124,partRemove:127,colorBg:130,colorSelect:133,mainMenuSubGenderSelectedBg:136,floorTile:152};class qt{constructor(t){this.cloudFrames=[],this.spriteLoader=t}async loadAll(){const t=Object.values(st).map(e=>`${e}.png`);for(let e=0;e<ct;e++)t.push(`cloud/cloud_${e}.png`);await this.spriteLoader.preloadUIAssets(t),this.cloudFrames=[];for(let e=0;e<ct;e++){const s=this.spriteLoader.getUIAsset(`cloud/cloud_${e}.png`);s&&this.cloudFrames.push(s)}}get(t){const e=st[t];return e===void 0?null:this.spriteLoader.getUIAsset(`${e}.png`)}getCloudFrames(){return this.cloudFrames}getAssetMap(){return st}}const jt=18,Zt=0,ht=60,Jt=5,Kt=10,Qt=50,dt=46,ut=130,te=12;class ee{constructor(t,e,s,i,o,r){this.openedMainIndex=0,this.locationX=t,this.locationY=e,this.uiAssets=s,this.hitRegions=i,this.eventBus=o,this.localization=r,this.openedIndexes=P.map(()=>0)}showMenuIndex(t,e){if(t!==void 0&&(this.openedMainIndex=Math.max(0,Math.min(t,P.length-1))),e!==void 0){const s=P[this.openedMainIndex].items.length-1;this.openedIndexes[this.openedMainIndex]=Math.max(0,Math.min(e,s))}}getMenuMainOpenedIndex(){return this.openedMainIndex}getMenuSubOpenedIndex(){return this.openedIndexes[this.openedMainIndex]}getSelectedSetType(){const t=P[this.openedMainIndex],e=this.openedIndexes[this.openedMainIndex];return t.items[e]}draw(t){this.hitRegions.removeByPrefix("mainmenu_");for(let e=0;e<P.length;e++){const s=P[e],i=this.locationX+jt+e*(ht+Jt),o=this.locationY+Zt,r=e===this.openedMainIndex,c=r?"mainMenuMainSelectedBg":"mainMenuMainUnselectedBg",n=this.uiAssets.get(c);n&&t.drawImage(n,i,o);const h=r?"Selected":"Unselected",a=this.uiAssets.get(`mainMenuMain_${s.id}_${h}`);a&&t.drawImage(a,i+12,o+5);const l=e;this.hitRegions.add({id:`mainmenu_main_${e}`,x:i,y:o,width:ht,height:n?n.height:40,cursor:"pointer",onClick:()=>this.mainItemClicked(l)})}this.drawSubMenu(t)}drawSubMenu(t){const e=P[this.openedMainIndex],s=e.items,i=e.type==="gender",o=this.locationY+Qt,r=i?ut:dt,c=this.openedIndexes[this.openedMainIndex];for(let n=0;n<s.length;n++){const h=s[n],a=this.locationX+Kt+n*(r+te),l=n===c;if(i){if(l){const I=this.uiAssets.get("mainMenuSubGenderSelectedBg");I&&t.drawImage(I,a,o)}const d=this.uiAssets.get(`mainMenuSub_${h}`);d&&t.drawImage(d,a+5,o);const f=h==="male"?this.localization.boy:this.localization.girl;t.save(),t.font="bold 12px Verdana",t.fillStyle="#000000",t.textBaseline="middle";const u=a+(d?d.width+10:50),p=o+17;t.fillText(f,u,p),t.restore(),this.hitRegions.add({id:`mainmenu_sub_${n}`,x:a,y:o,width:ut,height:35,cursor:"pointer",onClick:()=>this.subItemClicked(n,h)})}else{if(l){const f=this.uiAssets.get("mainMenuSubSelectedBg");f&&t.drawImage(f,a,o)}const d=this.uiAssets.get(`mainMenuSub_${h}`);d&&t.drawImage(d,a+5,o),this.hitRegions.add({id:`mainmenu_sub_${n}`,x:a,y:o,width:dt,height:40,cursor:"pointer",onClick:()=>this.subItemClicked(n,h)})}}}mainItemClicked(t){this.openedMainIndex=t;const e=this.openedIndexes[this.openedMainIndex],s=P[this.openedMainIndex].items[e];this.eventBus.emit("setTypeSelected",{setType:s})}subItemClicked(t,e){this.openedIndexes[this.openedMainIndex]=t,this.eventBus.emit("setTypeSelected",{setType:e})}}const gt=5,se=3,ft=9,A=45;class ie{constructor(t,e,s,i,o,r,c){this.currentSetType="hd",this.currentGender="M",this.currentColor="FFFFFF",this.currentSelectedId=0,this.setIsMandatory=!0,this.pageData=[],this.currentPageIndex=0,this.currentSelectionPageNo=0,this.previewCache=new Map,this.locationX=t,this.locationY=e,this.useClub=s,this.uiAssets=i,this.hitRegions=o,this.eventBus=r,this.previewRenderer=c}showMenu(t,e,s,i,o){this.currentSetType=t,this.currentGender=e,this.currentColor=s||"FDFDFD",this.currentSelectedId=i||0,this.setIsMandatory=o??!0,this.previewCache.clear(),this.currentSelectedId===0&&(this.currentSelectionPageNo=0);const r=w.getInstance().getSetsForSetType(this.currentSetType,this.currentGender,this.useClub,!0);this.pageData=[];let c=0,n=[];const h=gt*se;let a=0,l=0;for(;l<r.length;)c===0&&l===0?this.setIsMandatory||(n.push({type:"remove"}),a++):a===0&&c>0&&(n.push({type:"back"}),a++),a===h-1&&l<r.length?(n.push({type:"forward"}),a++):(r[l].getSetId()===i&&(this.currentSelectionPageNo=c),n.push({type:"part",index:l}),l++,a++),l===r.length?this.pageData.push(n):a===h&&(this.pageData.push(n),a=0,n=[],c++);r.length===0&&!this.setIsMandatory&&(this.pageData=[[{type:"remove"}]]),this.currentPageIndex=this.currentSelectionPageNo}setColor(t){this.currentColor=t,this.previewCache.clear()}setSelection(t){this.currentSelectedId=t}clearSelection(){this.currentSelectedId=0}getCurrentSetType(){return this.currentSetType}draw(t){if(this.hitRegions.removeByPrefix("bodypart_"),this.pageData.length===0)return;const e=Math.max(0,Math.min(this.currentPageIndex,this.pageData.length-1)),s=this.pageData[e];if(!s)return;const i=w.getInstance().getSetsForSetType(this.currentSetType,this.currentGender,this.useClub,!0);let o=0,r=0;for(let c=0;c<s.length;c++){const n=this.locationX+o*(A+ft),h=this.locationY+r*(A+ft),a=s[c];if(a.type==="part"&&a.index!==void 0){const l=i[a.index];if(!l){o++;continue}const f=l.getSetId()===this.currentSelectedId;this.drawPartItem(t,l,n,h,f),this.hitRegions.add({id:`bodypart_${c}`,x:n,y:h,width:A,height:A,cursor:"pointer",onClick:()=>{this.eventBus.emit("setSelected",{setId:l.getSetId(),setType:this.currentSetType})}})}else a.type==="remove"?(this.drawRemoveItem(t,n,h,this.currentSelectedId===0),this.hitRegions.add({id:"bodypart_remove",x:n,y:h,width:A,height:A,cursor:"pointer",onClick:()=>{this.eventBus.emit("setSelected",{setId:0,setType:this.currentSetType})}})):a.type==="forward"?(this.drawArrow(t,"Right",n,h),this.hitRegions.add({id:"bodypart_forward",x:n,y:h,width:A,height:A,cursor:"pointer",onClick:()=>{this.currentPageIndex++,this.eventBus.emit("stateChanged")}})):a.type==="back"&&(this.drawArrow(t,"Left",n,h),this.hitRegions.add({id:"bodypart_back",x:n,y:h,width:A,height:A,cursor:"pointer",onClick:()=>{this.currentPageIndex--,this.eventBus.emit("stateChanged")}}));o++,o>=gt&&(o=0,r++)}}drawPartItem(t,e,s,i,o){const r=e.getSetId();if(!this.previewCache.has(r)){const n=this.previewRenderer.renderIcon(e,this.currentColor);this.previewCache.set(r,n)}const c=this.previewCache.get(r);if(t.save(),t.beginPath(),t.rect(s,i,A,A),t.clip(),t.drawImage(c,s,i),t.restore(),o){const n=this.uiAssets.get("partSelected");n&&t.drawImage(n,s-1,i-1)}if(e.isClubOnly()){const n=this.uiAssets.get("hcTagSmall");n&&t.drawImage(n,s+A-n.width-1,i+A-n.height-1)}}drawRemoveItem(t,e,s,i){const o=this.uiAssets.get("partRemove");if(o&&t.drawImage(o,e,s),i){const r=this.uiAssets.get("partSelected");r&&t.drawImage(r,e-1,s-1)}}drawArrow(t,e,s,i){const o=e==="Right"?"partArrowRight":"partArrowLeft",r=this.uiAssets.get(o);r&&t.drawImage(r,s+6,i+6)}}const z=27,V=27,oe=3,re=2,pt=9,ne=4,q=3;class ae{constructor(t,e,s,i,o){this.currentSelectedId=0,this.targetSetType="hd",this.showClubColors=!1,this.currentPaletteId=1,this.pageData=[],this.currentPageIndex=0,this.currentSelectionPageNo=0,this.locationX=t,this.locationY=e,this.uiAssets=s,this.hitRegions=i,this.eventBus=o}showColorChooser(t,e,s,i){this.currentSelectedId=e||0,this.targetSetType=s,this.showClubColors=i??!1,this.currentPaletteId=t,this.currentSelectionPageNo=0;const o=w.getInstance().getColorsForPaletteId(this.currentPaletteId,this.showClubColors,!0);this.pageData=[];let r=[],c=0;const n=pt*ne;let h=0,a=0;for(;a<o.length;)h===0&&c>0&&(r.push({type:"back"}),h++),h===n-1&&a<o.length-1?(r.push({type:"forward"}),h++):(o[a].getID()===this.currentSelectedId&&(this.currentSelectionPageNo=c),r.push({type:"color",index:a}),a++,h++),a===o.length?this.pageData.push(r):h===n&&(this.pageData.push(r),h=0,r=[],c++);this.currentPageIndex=this.currentSelectionPageNo}getCurrentSelectedColorId(){return this.currentSelectedId}draw(t){if(this.hitRegions.removeByPrefix("color_"),this.pageData.length===0)return;const e=Math.max(0,Math.min(this.currentPageIndex,this.pageData.length-1)),s=this.pageData[e];if(!s)return;const i=w.getInstance().getColorsForPaletteId(this.currentPaletteId,this.showClubColors,!0);let o=0,r=0;for(let c=0;c<s.length;c++){const n=this.locationX+o*(z+oe),h=this.locationY+r*(V+re),a=s[c];if(a.type==="color"&&a.index!==void 0){const l=i[a.index];if(!l){o++;continue}const d=l.getID()===this.currentSelectedId;this.drawColorButton(t,l,n,h,d);const f=l.getID(),u=l.getColorStr();this.hitRegions.add({id:`color_${c}`,x:n,y:h,width:z,height:V,cursor:"pointer",onClick:()=>{this.currentSelectedId=f,this.eventBus.emit("colorSelected",{colorStr:u,targetSetType:this.targetSetType,colorId:f})}})}else a.type==="forward"?(this.drawSmallArrow(t,"Right",n,h),this.hitRegions.add({id:"color_forward",x:n,y:h,width:z,height:V,cursor:"pointer",onClick:()=>{this.currentPageIndex++,this.eventBus.emit("stateChanged")}})):a.type==="back"&&(this.drawSmallArrow(t,"Left",n,h),this.hitRegions.add({id:"color_back",x:n,y:h,width:z,height:V,cursor:"pointer",onClick:()=>{this.currentPageIndex--,this.eventBus.emit("stateChanged")}}));o++,o>=pt&&(o=0,r++)}}drawColorButton(t,e,s,i,o){const r=e.getColorStr(),[c,n,h]=et(r),a=this.uiAssets.get("colorBg");if(a){const l=document.createElement("canvas");l.width=a.width,l.height=a.height;const d=l.getContext("2d");d.drawImage(a,0,0);const f=d.getImageData(0,0,a.width,a.height),u=f.data,p=c/255,I=n/255,C=h/255;for(let m=0;m<u.length;m+=4)u[m]=Math.round(u[m]*p),u[m+1]=Math.round(u[m+1]*I),u[m+2]=Math.round(u[m+2]*C);d.putImageData(f,0,0),t.drawImage(l,s+q,i+q)}else t.fillStyle=`#${r}`,t.fillRect(s+q,i+q,21,21);if(e.isClubOnly()){const l=this.uiAssets.get("hcTagSmall");l&&t.drawImage(l,s+1,i+1)}if(o){const l=this.uiAssets.get("colorSelect");l&&t.drawImage(l,s,i)}}drawSmallArrow(t,e,s,i){const o=e==="Right"?"arrowSmallRight":"arrowSmallLeft",r=this.uiAssets.get(o);r&&t.drawImage(r,s+3,i+3)}}class le{constructor(t,e,s,i,o,r,c,n){this.uiAssets=t,this.hitRegions=e,this.eventBus=s,this.avatarRenderer=i,this.figure=o,this.direction=r,this.showArrows=c,this.displayX=n}setFigure(t){this.figure=t}setDirection(t){this.direction=t}getDirection(){return this.direction}rotateNext(){this.direction--,this.direction<0&&(this.direction=7)}rotatePrev(){this.direction++,this.direction>7&&(this.direction=0)}draw(t){this.hitRegions.removeByPrefix("avatar_");const e=this.uiAssets.get("floorTile");if(e&&t.drawImage(e,this.displayX+5,J+165),this.avatarRenderer.drawAvatarToCanvas(t,this.figure,this.direction,this.displayX,J,bt),this.showArrows){const s=this.uiAssets.get("rotateArrowLeft"),i=this.uiAssets.get("rotateArrowRight"),o=J+100;if(s){const r=this.displayX-20;t.drawImage(s,r,o),this.hitRegions.add({id:"avatar_rotateLeft",x:r,y:o,width:s.width,height:s.height,cursor:"pointer",onClick:()=>{this.rotateNext(),this.eventBus.emit("stateChanged")}})}if(i){const r=this.displayX+128+10;t.drawImage(i,r,o),this.hitRegions.add({id:"avatar_rotateRight",x:r,y:o,width:i.width,height:i.height,cursor:"pointer",onClick:()=>{this.rotatePrev(),this.eventBus.emit("stateChanged")}})}}}}const ce=1e3,he=700,de=350,ue=40,ge=40,fe=13;class pe{constructor(t,e,s,i,o){this.enabled=!0,this.cooldownTimer=null,this.clouds=[],this.cloudAnimationStart=0,this.cloudAnimationEnd=0,this.animating=!1,this.cloudFrames=[],this.nextSpawnIndex=0,this.uiAssets=t,this.hitRegions=e,this.eventBus=s,this.localization=i,this.displayX=o}draw(t){this.hitRegions.removeByPrefix("randomize_");const e=this.uiAssets.get("randomizeButtonBg");e&&(t.drawImage(e,K,Q),t.save(),t.font="bold 11px Verdana",t.fillStyle="#000000",t.textAlign="center",t.textBaseline="middle",t.fillText(this.localization.randomize,K+e.width/2,Q+e.height/2),t.restore(),this.hitRegions.add({id:"randomize_btn",x:K,y:Q,width:e.width,height:e.height,cursor:this.enabled?"pointer":"default",onClick:()=>this.handleClick()}))}drawClouds(t){if(!this.animating)return;const e=Date.now();if(e>=this.cloudAnimationEnd){this.animating=!1,this.clouds=[];return}const s=e-this.cloudAnimationStart;if(s<de){const i=Math.floor(s/ue)+1;for(;this.nextSpawnIndex<i;)this.clouds.push({x:At+Math.random()*Tt,y:Mt+Math.random()*vt,startTime:e}),this.nextSpawnIndex++}if(this.cloudFrames.length!==0){t.save(),t.imageSmoothingEnabled=!1;for(const i of this.clouds){const o=Math.floor((e-i.startTime)/ge);if(o>=fe)continue;const r=this.cloudFrames[o];r&&t.drawImage(r,i.x,i.y)}t.restore()}}isAnimating(){return this.animating}handleClick(){this.enabled&&(this.enabled=!1,this.cooldownTimer=window.setTimeout(()=>{this.enabled=!0,this.cooldownTimer=null},ce),this.cloudFrames=this.uiAssets.getCloudFrames(),this.animating=!0,this.cloudAnimationStart=Date.now(),this.cloudAnimationEnd=this.cloudAnimationStart+he,this.clouds=[],this.nextSpawnIndex=0,this.eventBus.emit("randomizeAvatar"))}}const me=5e3;class Ie{constructor(){this.initBlockActive=!0,this.editorOkToProceed=!0,this.initBlockTimer=null,this.initBlockTimer=window.setTimeout(()=>{this.initBlockActive=!1,this.setAllowedToProceed(this.editorOkToProceed)},me)}setGenderAndFigure(t,e){var s,i;try{(i=(s=window.HabboEditor)==null?void 0:s.setGenderAndFigure)==null||i.call(s,t,e)}catch(o){console.warn("HabboEditor.setGenderAndFigure failed:",o)}}setAllowedToProceed(t){var e,s;if(this.editorOkToProceed=t,!this.initBlockActive)try{(s=(e=window.HabboEditor)==null?void 0:e.setAllowedToProceed)==null||s.call(e,t)}catch(i){console.warn("HabboEditor.setAllowedToProceed failed:",i)}}setEditorState(t){var e,s;try{(s=(e=window.HabboEditor)==null?void 0:e.setEditorState)==null||s.call(e,t)}catch(i){console.warn("HabboEditor.setEditorState failed:",i)}}showHabboClubNotice(){var t,e;try{(e=(t=window.HabboEditor)==null?void 0:t.showHabboClubNotice)==null||e.call(t)}catch(s){console.warn("HabboEditor.showHabboClubNotice failed:",s)}}hideHabboClubNotice(){var t,e;try{(e=(t=window.HabboEditor)==null?void 0:t.hideHabboClubNotice)==null||e.call(t)}catch(s){console.warn("HabboEditor.hideHabboClubNotice failed:",s)}}showOldFigureNotice(){var t,e;try{(e=(t=window.HabboEditor)==null?void 0:t.showOldFigureNotice)==null||e.call(t)}catch(s){console.warn("HabboEditor.showOldFigureNotice failed:",s)}}destroy(){this.initBlockTimer!==null&&clearTimeout(this.initBlockTimer)}}const mt=14,Se=83;let It=[],j=0,Z=null;function ye(g){const t=g+(g.endsWith("/")?"":"/"),e=[];for(let s=1;s<=mt;s++){const i=new Image;e.push(new Promise(o=>{i.onload=()=>o(),i.onerror=()=>o()})),i.src=`${t}frames/${s}.png`,It[s-1]=i}return Promise.all(e).then(()=>{})}function we(g){const t=g.getContext("2d");t&&(j=0,St(t,g.width,g.height),Z=window.setInterval(()=>{j=(j+1)%mt,St(t,g.width,g.height)},Se))}function be(){Z!==null&&(clearInterval(Z),Z=null)}function St(g,t,e){g.fillStyle="#FFFFFF",g.fillRect(0,0,t,e);const s=It[j];s&&s.complete&&s.naturalWidth>0&&g.drawImage(s,0,0)}class it{constructor(t,e){this.config={...wt,...e},this.container=t,this.hitRegions=new Vt,this.state=new xt(this.config.userHasClub,this.config.showClubSelections),this.spriteLoader=new Lt(this.config.assetsPath),this.avatarRenderer=new Ht(this.spriteLoader),this.previewIconRenderer=new Wt(this.spriteLoader),this.bridge=new Ie,this.init()}async init(){const t=this.config.assetsPath,s=this.config.showRotationArrows?rt:nt,i=document.createElement("canvas");i.width=s,i.height=G,i.style.display="block",this.container.appendChild(i),await ye(t),we(i);const o=3e3,r=Date.now(),c=t+(t.endsWith("/")?"":"/")+"data/";await Promise.all([w.getInstance().loadFromUrl(c+"figuredata.xml"),$.getInstance().loadFromUrl(c+"draworder.xml"),O.getInstance().loadFromUrl(c+"symbols.csv"),O.getInstance().loadOffsetsFromUrl(c+"spriteoffsets.csv")]);const n=O.getInstance(),h=n.getAllNames().map(d=>n.getFilenameForName(d)).filter(Boolean);await this.spriteLoader.preloadAllSprites(h),console.log(`[HabboEditor] Loaded ${h.length} avatar sprites`),this.uiAssets=new qt(this.spriteLoader),await this.uiAssets.loadAll(),console.log("[HabboEditor] UI assets loaded");const a=Date.now()-r;a<o&&await new Promise(d=>setTimeout(d,o-a)),be(),this.container.removeChild(i),this.initFigure(),console.log(`[HabboEditor] Figure: ${this.state.figure.getFigureString()} gender=${this.state.figure.getGender()}`),this.createUI(),this.canvasManager.setDrawCallback(()=>this.drawAll()),this.canvasManager.startContinuousRender(),this.bridge.setGenderAndFigure(this.state.figure.getGender(),this.state.figure.getFigureString()),this.checkClubSetsStatus()&&this.bridge.setAllowedToProceed(!1),this.config.menuState&&this.updatePartAndColorMenu(this.config.menuState)}initFigure(){const t=this.config.figure,e=this.config.gender;if(!t||!e||t===""||e===""){const s=!e||e===""?"U":e;this.state.figure=new E,this.state.figure.randomizeFigure(s,this.config.userHasClub&&this.config.showClubSelections)}else this.state.figure=new E(e),this.state.figure.parseFigureString(t)||this.bridge.showOldFigureNotice();this.state.storedFemaleFigure=new E("F"),this.state.storedMaleFigure=new E("M")}createUI(){const t=this.config.showRotationArrows,e=t?rt:nt,s=t?Ct:Ft;this.canvasManager=new zt(this.container,this.hitRegions,e),this.mainMenu=new ee(0,0,this.uiAssets,this.hitRegions,this.state.eventBus,this.config.localization);const i=this.state.figure.getGender()==="F"?1:0;this.mainMenu.showMenuIndex(0,i),this.bodyPartMenu=new ie(9,100,this.config.showClubSelections,this.uiAssets,this.hitRegions,this.state.eventBus,this.previewIconRenderer),this.initBodyPartMenu(),this.colorChooser=new ae(15,270,this.uiAssets,this.hitRegions,this.state.eventBus),this.initColorChooser(),this.avatarDisplay=new le(this.uiAssets,this.hitRegions,this.state.eventBus,this.avatarRenderer,this.state.figure,this.state.avatarDirection,t,s),this.randomizeButton=new pe(this.uiAssets,this.hitRegions,this.state.eventBus,this.config.localization,s),this.wireEvents()}initBodyPartMenu(){const t=w.getInstance(),e=this.state.figure.getSetTypeColorId(R),s=t.getColorData(e),i=s?s.getColorStr():"FFFFFF",o=this.state.figure.getSetItemByType(R),r=o?o.getSetId():0,c=t.isSetTypeMandatory(R);this.bodyPartMenu.showMenu(R,this.state.figure.getGender(),i,r,c)}initColorChooser(){const e=w.getInstance().getPaletteIdForSetType(R),s=this.state.figure.getSetTypeColorId(R);this.colorChooser.showColorChooser(e,s,R,this.config.showClubSelections)}wireEvents(){const t=this.state.eventBus;t.on("setTypeSelected",e=>{this.handleSetTypeSelection(e)}),t.on("setSelected",e=>{this.handleSetSelection(e)}),t.on("colorSelected",e=>{this.handleColorSelection(e)}),t.on("randomizeAvatar",()=>{this.handleRandomize()}),t.on("stateChanged",()=>{this.canvasManager.requestRedraw()})}handleSetTypeSelection(t){let e=t.setType;const s=this.state.figure.getGender();let i=s;if((e==="male"||e==="female")&&(i=e==="male"?"M":"F",e="hd"),s!==i){const a=this.state.figure.getFigureString();i==="M"?(this.state.storedFemaleFigure.parseFigureString(a),this.state.figure.setGender(i),this.state.figure.parseFigureString(this.state.storedMaleFigure.getFigureString())):(this.state.storedMaleFigure.parseFigureString(a),this.state.figure.setGender(i),this.state.figure.parseFigureString(this.state.storedFemaleFigure.getFigureString())),this.state.figure.getFigureString().length===0&&(this.state.figure.randomizeFigure(i,this.config.userHasClub&&this.config.showClubSelections),this.checkClubSetsStatus()),this.bridge.setGenderAndFigure(this.state.figure.getGender(),this.state.figure.getFigureString()),this.bridge.setAllowedToProceed(!0)}this.state.currentSetType=e;const o=w.getInstance(),r=o.isSetTypeMandatory(e),c=o.getPaletteIdForSetType(e),n=this.state.figure.getSetItemByType(e);if(n){const a=n.getSetId(),l=n.getColorId(),d=o.getColorData(l),f=d?d.getColorStr():"FFFFFF";this.colorChooser.showColorChooser(c,l,e,this.config.showClubSelections),this.bodyPartMenu.showMenu(e,i,f,a,r)}else{const a=o.getColorsForPaletteId(c,this.config.userHasClub,!0),l=a.length>0?a[0].getID():0,d=a.length>0?a[0].getColorStr():"FFFFFF";this.colorChooser.showColorChooser(c,l,e,this.config.showClubSelections),this.bodyPartMenu.showMenu(e,i,d,0,r)}this.avatarDisplay.setFigure(this.state.figure);const h=`${e}-${this.mainMenu.getMenuMainOpenedIndex()}-${this.mainMenu.getMenuSubOpenedIndex()}`;this.bridge.setEditorState(h),this.canvasManager.requestRedraw()}handleSetSelection(t){const e=w.getInstance(),s=t.setType;let i=t.setId,o=!0;const r=e.getPaletteIdForSetType(s);let c=this.state.figure.getSetTypeColorId(s);if((c===void 0||c===-1)&&(c=this.colorChooser.getCurrentSelectedColorId()),c===void 0||c===-1){const l=e.getColorsForPaletteId(r);l.length>0&&(c=l[0].getID(),this.colorChooser.showColorChooser(r,c,s,this.config.showClubSelections))}const n=e.getColorData(c),h=n?n.getColorStr():"FFFFFF",a=this.state.figure.getSetItemByType(s);a&&i===a.getSetId()&&(e.isSetTypeMandatory(s)||(i=0,o=!1,this.bodyPartMenu.clearSelection())),i===0?this.state.figure.removeSetItemByType(s):this.state.figure.setSetItem(s,i,c),o&&(this.bodyPartMenu.setSelection(i),this.bodyPartMenu.setColor(h)),this.bridge.setGenderAndFigure(this.state.figure.getGender(),this.state.figure.getFigureString()),this.avatarDisplay.setFigure(this.state.figure),this.checkClubSetsStatus(),this.canvasManager.requestRedraw()}handleColorSelection(t){const e=t.colorStr,s=t.targetSetType,i=t.colorId;this.bodyPartMenu.setColor(e),this.state.figure.setSetTypeColor(s,i),this.bridge.setGenderAndFigure(this.state.figure.getGender(),this.state.figure.getFigureString()),this.avatarDisplay.setFigure(this.state.figure),this.checkClubSetsStatus(),this.canvasManager.requestRedraw()}handleRandomize(){this.state.figure.randomizeFigure(this.state.figure.getGender(),this.config.userHasClub&&this.config.showClubSelections),this.bridge.setGenderAndFigure(this.state.figure.getGender(),this.state.figure.getFigureString()),this.avatarDisplay.setFigure(this.state.figure),this.updatePartAndColorMenu(),this.canvasManager.requestRedraw()}updatePartAndColorMenu(t){const e=w.getInstance();let s=this.bodyPartMenu.getCurrentSetType();if(t){const l=t.split("-"),d=l[0],f=parseInt(l[1],10),u=parseInt(l[2],10);this.mainMenu.showMenuIndex(f,u);const p=e.getSetTypes();for(const[I]of p)if(I===d){s=d;break}}const i=this.state.figure.getGender(),o=e.isSetTypeMandatory(s),r=e.getPaletteIdForSetType(s),c=this.state.figure.getSetItemByType(s);let n,h,a;if(c){n=c.getSetId(),h=c.getColorId();const l=e.getColorData(h);a=l?l.getColorStr():"FFFFFF"}else{n=0;const l=e.getColorsForPaletteId(r,this.config.userHasClub,!0);h=l.length>0?l[0].getID():0,a=l.length>0?l[0].getColorStr():"FFFFFF"}this.colorChooser.showColorChooser(r,h,s,this.config.showClubSelections),this.bodyPartMenu.showMenu(s,i,a,n,o),this.checkClubSetsStatus(),this.avatarDisplay.setFigure(this.state.figure)}checkClubSetsStatus(){return this.state.figure.getClubSets().length>0&&!this.config.userHasClub?(this.bridge.setAllowedToProceed(!1),this.bridge.showHabboClubNotice(),!1):this.state.figure.getClubColors().length>0&&!this.config.userHasClub?(this.bridge.setAllowedToProceed(!1),this.bridge.showHabboClubNotice(),!1):(this.bridge.setAllowedToProceed(!0),this.bridge.hideHabboClubNotice(),!0)}drawBorders(t){t.beginPath(),t.moveTo(11,50),t.lineTo(286,50),t.arcTo(294,50,294,58,8),t.lineTo(294,78),t.arcTo(294,86,286,86,8),t.lineTo(11,86),t.arcTo(3,86,3,78,8),t.lineTo(3,58),t.arcTo(3,50,11,50,8),t.closePath(),t.fillStyle="#E5E3E1",t.fill();const M=18+this.mainMenu.getMenuMainOpenedIndex()*65,D=60;t.beginPath(),t.moveTo(3,55),t.arcTo(3,47,11,47,8),t.lineTo(M,47),t.moveTo(M+D,47),t.lineTo(286,47),t.arcTo(294,47,294,55,8),t.lineTo(294,251),t.arcTo(294,259,286,259,8),t.lineTo(11,259),t.arcTo(3,259,3,251,8),t.lineTo(3,55),t.strokeStyle="#FFCC00",t.lineWidth=3,t.stroke();const y=3,v=291,H=272,k=4*27+3*2,U=H-9,_=9+k+9,S=U;t.beginPath(),t.moveTo(128,S),t.lineTo(140,S-8),t.lineTo(152,S),t.closePath(),t.fillStyle="#FFFFFF",t.fill(),t.beginPath(),t.moveTo(y+8,S),t.lineTo(128,S),t.lineTo(140,S-8),t.lineTo(152,S),t.lineTo(y+v-8,S),t.arcTo(y+v,S,y+v,S+8,8),t.lineTo(y+v,S+_-8),t.arcTo(y+v,S+_,y+v-8,S+_,8),t.lineTo(y+8,S+_),t.arcTo(y,S+_,y,S+_-8,8),t.lineTo(y,S+8),t.arcTo(y,S,y+8,S,8),t.closePath(),t.strokeStyle="#000000",t.lineWidth=2,t.stroke()}drawAll(){const t=this.canvasManager.ctx;this.drawBorders(t),this.avatarDisplay.draw(t),this.randomizeButton.draw(t),this.mainMenu.draw(t),this.bodyPartMenu.draw(t),this.colorChooser.draw(t),this.randomizeButton.drawClouds(t)}getFigureString(){return this.state.figure.getFigureString()}getGender(){return this.state.figure.getGender()}}window.HabboAvatarEditor=it;const yt=document.getElementById("editor-container");if(yt){const g=window.HabboEditorConfig||{};new it(yt,g)}ot.HabboAvatarEditor=it,Object.defineProperty(ot,Symbol.toStringTag,{value:"Module"})})(this.HabboAvatarEditor=this.HabboAvatarEditor||{});
