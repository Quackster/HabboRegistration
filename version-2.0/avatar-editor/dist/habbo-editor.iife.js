(function(et){"use strict";const ft={figure:"",gender:"U",userHasClub:!1,showClubSelections:!0,assetsPath:"",localization:{randomize:"Randomize",boy:"Boy",girl:"Girl"}},q=495,W=400,H=64,B=106,G=68,st=2,k=323,V=70,pt=4,v="hd",mt=[0,1,2,3,2,1,0,7],P=[{id:"body",type:"gender",items:["male","female"]},{id:"head",type:"part",items:["hr","ha","he","ea","fa"]},{id:"chest",type:"part",items:["ch","ca"]},{id:"legs",type:"part",items:["lg","sh","wa"]}];class It{constructor(t,e,s,i,r,o,c,n,h){this.setId=t,this.setType=e,this.paletteId=s,this.gender=i,this.clubOnly=o,this.selectable=c,this.colorable=n,this.parts=r,this.hiddenLayers=h}getSetId(){return this.setId}getSetType(){return this.setType}getPaletteId(){return this.paletteId}getGender(){return this.gender}isClubOnly(){return this.clubOnly}isSelectable(){return this.selectable}isColorable(){return this.colorable}getParts(){return this.parts}getHiddenLayers(){return this.hiddenLayers}}class yt{constructor(t,e,s,i,r,o){this.paletteId=t,this.color=e,this.id=s,this.index=i,this.clubOnly=r,this.selectable=o}getPaletteId(){return this.paletteId}getColorStr(){return this.color}getID(){return this.id}getIndex(){return this.index}isClubOnly(){return this.clubOnly}isSelectable(){return this.selectable}}class St{constructor(t,e,s){this.partId=t,this.partType=e,this.colorable=s}getPartId(){return this.partId}getPartType(){return this.partType}isPartColorable(){return this.colorable}}const O=class O{constructor(){this.setTypeArr=[],this.setArr=[],this.paletteArr=[],this.loaded=!1}static getInstance(){return O.instance||(O.instance=new O),O.instance}async loadFromUrl(t){const e=await fetch(t);if(!e.ok){console.error(`[FigureData] Failed to load: ${t} (${e.status})`);return}const s=await e.text(),r=new DOMParser().parseFromString(s,"text/xml");this.parseXml(r),console.log(`[FigureData] Loaded ${this.setArr.length} sets, ${this.paletteArr.length} colors, ${this.setTypeArr.length} set types`)}parseXml(t){const e=t.querySelector("figuredata");if(!e)return;const s=e.querySelector("sets");s&&this.parseSets(s);const i=e.querySelector("colors");i&&this.parseColors(i),this.loaded=!0}isLoaded(){return this.loaded}getSetTypes(){return this.setTypeArr}getSetForId(t){for(const e of this.setArr)if(e.getSetId()===t)return e;return null}getSetsForSetType(t,e,s=!0,i=!0){const r=[];for(const o of this.setArr)i&&!o.isSelectable()||o.getSetType()===t&&(o.getGender()!==e&&o.getGender()!=="U"||!s&&o.isClubOnly()||r.push(o));return r}getPaletteIdForSetType(t){for(const e of this.setArr)if(e.getSetType()===t)return e.getPaletteId();return 1}getPartsForSetId(t){for(const e of this.setArr)if(e.getSetId()===t)return e.getParts();return[]}getColorsForPaletteId(t,e=!0,s=!0){const i=[];for(const r of this.paletteArr)s&&!r.isSelectable()||r.getPaletteId()===t&&(!e&&r.isClubOnly()||i.push(r));return i}getColorData(t){for(const e of this.paletteArr)if(e.getID()===t)return e;return null}isSetTypeMandatory(t){for(const[e,s]of this.setTypeArr)if(e===t)return s;return!1}parseColors(t){this.paletteArr=[];const e=t.querySelectorAll("palette");for(const s of e){const i=parseInt(s.getAttribute("id")||"0",10),r=s.querySelectorAll("color");for(const o of r){const c=parseInt(o.getAttribute("id")||"0",10),n=parseInt(o.getAttribute("index")||"0",10),h=o.getAttribute("club")==="1",a=o.getAttribute("selectable")==="1",l=o.textContent||"FFFFFF";this.paletteArr.push(new yt(i,l,c,n,h,a))}}}parseSets(t){this.setArr=[],this.setTypeArr=[];const e=t.querySelectorAll("settype");for(const s of e){const i=s.getAttribute("type")||"",r=parseInt(s.getAttribute("paletteid")||"0",10),o=s.getAttribute("mandatory")==="1";this.setTypeArr.push([i,o]);const c=s.querySelectorAll("set");for(const n of c){const h=parseInt(n.getAttribute("id")||"0",10),a=n.getAttribute("gender")||"U",l=n.getAttribute("club")==="1",d=n.getAttribute("colorable")==="1",u=n.getAttribute("selectable"),g=u===null?!0:u==="1",f=[],S=n.querySelectorAll(":scope > part");for(const w of S){const T=parseInt(w.getAttribute("id")||"0",10),p=w.getAttribute("type")||"",F=w.getAttribute("colorable")==="1";f.push(new St(T,p,F))}const C=[],m=n.querySelector("hiddenlayers");if(m){const w=m.querySelectorAll("layer");for(const T of w){const p=T.getAttribute("parttype")||"";C.push(p)}}this.setArr.push(new It(h,i,r,a,f,l,g,d,C))}}}};O.instance=null;let b=O;const N=class N{constructor(){this.drawOrderData={},this.loaded=!1}static getInstance(){return N.instance||(N.instance=new N),N.instance}async loadFromUrl(t){const e=await fetch(t);if(!e.ok){console.error(`[DrawOrder] Failed to load: ${t} (${e.status})`);return}const s=await e.text(),r=new DOMParser().parseFromString(s,"text/xml");this.parseXml(r);const o=Object.keys(this.drawOrderData).length;console.log(`[DrawOrder] Loaded ${o} actions`)}parseXml(t){const e=t.querySelectorAll("action");for(const s of e){const i=s.getAttribute("id")||"std";this.drawOrderData[i]={};const r=s.querySelectorAll("direction");for(const o of r){const c=o.getAttribute("id")||"0",n=[],h=o.querySelectorAll("part");for(const a of h){const l=a.getAttribute("set-type")||"";n.push(l)}this.drawOrderData[i][c]=n}}this.loaded=!0}isLoaded(){return this.loaded}getOrderArray(t,e){const i=this.drawOrderData["std"];if(!i)return[];const r=i[String(t)];return r||[]}};N.instance=null;let L=N;const x=class x{constructor(){this.nameToFileId=new Map,this.imageOffsets=new Map,this.loaded=!1}static getInstance(){return x.instance||(x.instance=new x),x.instance}async loadFromUrl(t){const e=await fetch(t);if(!e.ok){console.error(`[SymbolMap] Failed to load symbols CSV: ${t} (${e.status})`);return}const s=await e.text();this.parseCsv(s),console.log(`[SymbolMap] Loaded ${this.nameToFileId.size} symbol entries`)}async loadOffsetsFromUrl(t){const e=await fetch(t);if(!e.ok){console.error(`[SymbolMap] Failed to load offsets CSV: ${t} (${e.status})`);return}const s=await e.text();this.parseOffsets(s),console.log(`[SymbolMap] Loaded ${this.imageOffsets.size} sprite offsets`)}parseCsv(t){const e=t.trim().split(`
`);for(const s of e){const i=s.trim();if(!i)continue;const[r,o]=i.split(";");if(!o)continue;const n=parseInt(r,10)-2;this.nameToFileId.set(o.trim(),n)}this.loaded=!0}parseOffsets(t){const e=t.trim().split(`
`);for(const s of e){const i=s.trim();if(!i)continue;const r=i.split(";");if(r.length<3)continue;const o=parseInt(r[0],10),c=parseFloat(r[1]),n=parseFloat(r[2]);this.imageOffsets.set(o,{x:c,y:n})}}isLoaded(){return this.loaded}getFileIdForName(t){return this.nameToFileId.get(t)??null}getFilenameForName(t){const e=this.getFileIdForName(t);return e===null?null:`${e}.png`}getOffsetForImageId(t){return this.imageOffsets.get(t)??{x:0,y:0}}getOffsetForName(t){const e=this.getFileIdForName(t);return e===null?{x:0,y:0}:this.getOffsetForImageId(e)}getAllNames(){return Array.from(this.nameToFileId.keys())}};x.instance=null;let _=x;class bt{constructor(t,e,s){this.setType=t,this.setId=e,this.colorId=s}setValues(t,e,s){this.setType=t,this.setId=e,this.colorId=s}getSetType(){return this.setType}getSetId(){return this.setId}getColorId(){return this.colorId}}const it=".",j="-",wt=[["M","hr",97],["M","ha",40],["M","he",15],["M","ea",30],["M","fa",15],["M","ca",10],["M","wa",40],["M","sh",95],["F","hr",100],["F","ha",40],["F","he",25],["F","ea",15],["F","fa",8],["F","ca",15],["F","wa",40],["F","sh",95]];class E{constructor(t,e){this.figureData=[],this.gender="M",t&&this.setGender(t),e&&this.parseFigureString(e)}setGender(t){switch(t.toLowerCase()){case"m":case"male":this.gender="M";break;case"f":case"female":this.gender="F";break;default:this.gender=t.toUpperCase()}}getGender(){return this.gender}getFigureData(){return this.figureData}parseFigureString(t){if(this.figureData=[],!t||t.length===0)return!1;const e=b.getInstance(),s=t.split(it);let i=!0;for(const o of s){const c=o.split(j);if(c.length!==3)return this.figureData=[],!1;let n=c[0],h=parseInt(c[1],10),a=parseInt(c[2],10)||0;const l=e.getSetForId(h);if(l&&l.isSelectable()){if(l.isColorable()&&a>0){const d=e.getColorData(a);if(d&&!(d.getPaletteId()===l.getPaletteId())){const g=e.getColorsForPaletteId(l.getPaletteId(),!1,!0);g.length>0&&(a=g[0].getID(),i=!1)}}}else{const d=e.getSetsForSetType(n,this.gender,!1,!0);if(d.length>0){const u=d[0];h=u.getSetId();const g=e.getColorsForPaletteId(u.getPaletteId(),!1,!0);g.length>0&&(a=g[0].getID()),i=!1}}this.setSetItem(n,h,a)}return this.validateAndFixFigure()&&i}getFigureString(){const t=b.getInstance(),e=[];for(const s of this.figureData){const i=s.getSetType(),r=s.getSetId(),o=s.getColorId(),c=t.getSetForId(r);let n="";c&&c.isColorable()&&(n=String(o)),e.push(`${i}${j}${r}${j}${n}`)}return e.join(it)}setSetItem(t,e,s){for(const i of this.figureData)if(i.getSetType()===t){i.setValues(t,e,s);return}this.figureData.push(new bt(t,e,s))}removeSetItemByType(t){const e=this.figureData.findIndex(s=>s.getSetType()===t);e!==-1&&this.figureData.splice(e,1)}setSetTypeColor(t,e){for(const s of this.figureData)s.getSetType()===t&&s.setValues(t,s.getSetId(),e)}getSetItemById(t){for(const e of this.figureData)if(e.getSetId()===t)return e;return null}getSetItemByType(t){for(const e of this.figureData)if(e.getSetType()===t)return e;return null}getSetTypeColorId(t){const e=this.getSetItemByType(t);return e?e.getColorId():-1}getClubColors(){const t=b.getInstance(),e=[];for(const s of this.figureData){const i=t.getColorData(s.getColorId());i&&i.isClubOnly()&&e.push({colorData:i})}return e}getClubSets(){const t=b.getInstance(),e=[];for(const s of this.figureData){const i=t.getSetForId(s.getSetId());i&&i.isClubOnly()&&e.push({setData:i})}return e}randomizeFigure(t,e=!1){this.figureData=[];let s=t;t==="U"&&(s=Math.random()<.5?"M":"F"),this.setGender(s);const i=b.getInstance(),r=i.getSetTypes();for(const[o,c]of r){const n=this.getSetTypeProbability(o),h=Math.floor(Math.random()*100)<=n;if(c||h){const a=i.getSetsForSetType(o,this.gender,e,!0);if(a.length===0)continue;const l=a[Math.floor(Math.random()*a.length)],d=l.getPaletteId();let u=i.getColorsForPaletteId(d,e,!0);if(o==="hd"&&(u=u.slice(0,10)),u.length===0)continue;const g=Math.floor(Math.random()*u.length),f=u[g].getID();this.setSetItem(o,l.getSetId(),f)}}}getSetTypeProbability(t){for(const[e,s,i]of wt)if(e===this.gender&&s===t)return i;return 30}validateAndFixFigure(){const t=b.getInstance(),e=[];let s=!0;for(const i of this.figureData){const r=i.getSetType(),o=i.getSetId(),c=t.getSetForId(o);if(!c||!c.isSelectable()){const n=t.getSetsForSetType(r,this.gender,!1,!0);n.length>0&&e.push({setType:n[0].getSetType(),setId:n[0].getSetId(),paletteId:n[0].getPaletteId()})}else{const n=i.getColorId(),h=t.getColorData(n);if(h&&!h.isSelectable()){const a=h.getPaletteId(),l=t.getColorsForPaletteId(a,!1,!0);l.length>0&&(this.setSetItem(r,o,l[0].getID()),s=!1)}}}for(const i of e){const r=t.getColorsForPaletteId(i.paletteId,!1,!0),o=r.length>0?r[0].getID():0;this.setSetItem(i.setType,i.setId,o),s=!1}return s}}class Ct{constructor(){this.listeners=new Map}on(t,e){this.listeners.has(t)||this.listeners.set(t,[]),this.listeners.get(t).push(e)}off(t,e){const s=this.listeners.get(t);if(s){const i=s.indexOf(e);i!==-1&&s.splice(i,1)}}emit(t,e){const s=this.listeners.get(t);if(s)for(const i of s)i(e)}}class Ft{constructor(t,e){this.mainMenuIndex=0,this.subMenuIndex=0,this.currentSetType=v,this.bodyPartPage=0,this.colorPage=0,this.avatarDirection=pt,this.userHasClub=t,this.showClubSelections=e,this.figure=new E,this.storedMaleFigure=new E("M"),this.storedFemaleFigure=new E("F"),this.eventBus=new Ct}}class Tt{constructor(t){this.spriteCache=new Map,this.uiCache=new Map,this.assetsPath=t.endsWith("/")?t:t+"/"}loadImage(t){return new Promise((e,s)=>{const i=new Image;i.onload=()=>e(i),i.onerror=()=>s(new Error(`Failed to load: ${t}`)),i.src=t})}async loadSprite(t){if(this.spriteCache.has(t))return this.spriteCache.get(t);const e=await this.loadImage(`${this.assetsPath}sprites/${t}`);return this.spriteCache.set(t,e),e}async loadUIAsset(t){if(this.uiCache.has(t))return this.uiCache.get(t);const e=await this.loadImage(`${this.assetsPath}ui/${t}`);return this.uiCache.set(t,e),e}getSprite(t){return this.spriteCache.get(t)||null}getUIAsset(t){return this.uiCache.get(t)||null}async preloadAllSprites(t,e){let s=0;const i=t.length,r=t.map(async o=>{try{await this.loadSprite(o)}catch{}s++,e==null||e(s,i)});await Promise.all(r)}async preloadUIAssets(t,e){let s=0;const i=t.length,r=t.map(async o=>{try{await this.loadUIAsset(o)}catch{}s++,e==null||e(s,i)});await Promise.all(r)}}function rt(I,t,e,s,i,r,o,c,n){const h=t.width,a=t.height;if(e===255&&s===255&&i===255){I.drawImage(t,r,o,h,a);return}const l=document.createElement("canvas");l.width=h,l.height=a;const d=l.getContext("2d");d.drawImage(t,0,0,h,a);const u=d.getImageData(0,0,h,a),g=u.data,f=e/255,S=s/255,C=i/255;for(let m=0;m<g.length;m+=4)g[m]=Math.round(g[m]*f),g[m+1]=Math.round(g[m+1]*S),g[m+2]=Math.round(g[m+2]*C);d.putImageData(u,0,0),I.drawImage(l,r,o)}function Z(I){const t=I.replace("#",""),e=parseInt(t.substring(0,2),16)||0,s=parseInt(t.substring(2,4),16)||0,i=parseInt(t.substring(4,6),16)||0;return[e,s,i]}const At=98;class Mt{constructor(t){this.debugLogDone=!1,this.spriteLoader=t}collectParts(t){const e=b.getInstance(),s=new Map,i=[];for(const r of t.getFigureData()){const o=r.getSetId(),c=r.getColorId(),n=e.getColorData(c),h=n?n.getColorStr():"FFFFFF",a=e.getSetForId(o);if(a){i.push(...a.getHiddenLayers());for(const l of e.getPartsForSetId(o)){const d=l.getPartType();s.has(d)||s.set(d,[]),s.get(d).push({partType:d,partId:l.getPartId(),colorStr:h,colorable:l.isPartColorable()})}}}return s.has("hrb")&&!i.includes("hrb")&&i.push("hr"),{partsMap:s,hiddenLayers:i}}drawAvatarToCanvas(t,e,s,i,r,o){const c=L.getInstance(),n=_.getInstance(),h=mt[s],a=s!==h;let l=c.getOrderArray(h,"std");l.length===0&&(l=["li","lh","ls","bd","sh","lg","ch","wa","hd","fc","ey","hr","hrb","ri","rh","rs","ea","ca","fa","ha","he"]);const{partsMap:d,hiddenLayers:u}=this.collectParts(e),g=!this.debugLogDone;g&&(this.debugLogDone=!0,console.log(`[AvatarRenderer] Direction=${s}, flipDir=${h}, needsFlip=${a}`),console.log(`[AvatarRenderer] Draw order (${l.length} layers):`,l.join(", ")),console.log("[AvatarRenderer] Parts available:",Array.from(d.keys()).join(", ")),console.log("[AvatarRenderer] Hidden layers:",u.join(", ")||"(none)"));const f=document.createElement("canvas");f.width=H,f.height=B;const S=f.getContext("2d");let C=0;for(const w of l){if(u.includes(w))continue;const T=d.get(w);if(T)for(const p of T){const F=`h_std_${p.partType}_${p.partId}_${h}_0`,R=n.getFilenameForName(F);if(!R){g&&console.warn(`[AvatarRenderer] No sprite found for: ${F}`);continue}const D=this.spriteLoader.getSprite(R);if(!D){g&&console.warn(`[AvatarRenderer] Sprite not loaded: ${R} (${F})`);continue}const $=n.getOffsetForName(F);let[M,y,tt]=[255,255,255];p.partType!=="ey"&&p.colorable&&([M,y,tt]=Z(p.colorStr));const gt=$.x,ut=$.y+At;g&&console.log(`[AvatarRenderer]   ${p.partType}:${p.partId} -> ${R} offset=(${$.x}, ${$.y}) draw=(${gt}, ${ut}) img=${D.width}x${D.height} color=${p.colorStr} tint=(${M},${y},${tt})`),rt(S,D,M,y,tt,gt,ut),C++}}g&&(console.log(`[AvatarRenderer] Rendered ${C} sprites to ${H}x${B} offscreen canvas`),console.log(`[AvatarRenderer] Drawing at screen (${i}, ${r}) scale=${o} -> ${H*o}x${B*o}`));const m=t.imageSmoothingEnabled;if(t.imageSmoothingEnabled=!1,a){const w=document.createElement("canvas");w.width=G,w.height=B;const T=w.getContext("2d");T.translate(G,0),T.scale(-1,1),T.drawImage(f,0,0),t.drawImage(w,0,0,G,B,i,r,G*o,B*o)}else t.drawImage(f,i,r,H*o,B*o);t.imageSmoothingEnabled=m}}const vt={hr:83,ha:82,he:82,ea:75,fa:72,hd:78,ch:53,ca:53,wa:43,lg:32,sh:23},Pt=-95,Rt={hr:1,ha:0,he:0,ea:-3,fa:-4,hd:0,ch:0,ca:0,wa:0,lg:0,sh:-2},Dt=-9,Bt=98,U=45;class _t{constructor(t){this.spriteLoader=t}renderIcon(t,e){const s=document.createElement("canvas");s.width=U,s.height=U;const i=s.getContext("2d"),r=_.getInstance(),o=L.getInstance(),c=t.getSetType(),n=t.getParts(),h=2,a=o.getOrderArray(h,"std"),l=new Set(["bd","lh","rh"]),d=[];for(const f of n){const S=f.getPartType();if(l.has(S))continue;const C=a.indexOf(S);d.push({partType:S,partId:f.getPartId(),colorable:f.isPartColorable(),depth:C>=0?C:999})}d.sort((f,S)=>f.depth-S.depth);const u=(vt[c]??50)+Pt,g=(Rt[c]??0)+Dt;i.save(),i.beginPath(),i.rect(0,0,U,U),i.clip();for(const f of d){const S=`h_std_${f.partType}_${f.partId}_${h}_0`,C=r.getFilenameForName(S);if(!C)continue;const m=this.spriteLoader.getSprite(C);if(!m)continue;const w=r.getOffsetForName(S);let[T,p,F]=[255,255,255];f.partType!=="ey"&&f.colorable&&([T,p,F]=Z(e));const R=w.x+g,D=w.y+Bt+u;rt(i,m,T,p,F,R,D)}return i.restore(),s}}class Et{constructor(t,e){this.drawCallback=null,this.animationFrameId=null,this.needsRedraw=!0,this.hitRegions=e,this.canvas=document.createElement("canvas"),this.canvas.width=q,this.canvas.height=W,this.canvas.style.display="block",this.ctx=this.canvas.getContext("2d"),t.appendChild(this.canvas),this.setupEventListeners()}setDrawCallback(t){this.drawCallback=t}requestRedraw(){this.needsRedraw=!0}startRenderLoop(){const t=()=>{var e;this.needsRedraw&&(this.needsRedraw=!1,this.clear(),(e=this.drawCallback)==null||e.call(this)),this.animationFrameId=requestAnimationFrame(t)};this.animationFrameId=requestAnimationFrame(t)}startContinuousRender(){const t=()=>{var e;this.clear(),(e=this.drawCallback)==null||e.call(this),this.animationFrameId=requestAnimationFrame(t)};this.animationFrameId=requestAnimationFrame(t)}stopRenderLoop(){this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}clear(){this.ctx.fillStyle="#FFFFFF",this.ctx.fillRect(0,0,q,W)}getCanvasCoords(t){const e=this.canvas.getBoundingClientRect(),s=q/e.width,i=W/e.height;return{x:(t.clientX-e.left)*s,y:(t.clientY-e.top)*i}}setupEventListeners(){this.canvas.addEventListener("click",t=>{const{x:e,y:s}=this.getCanvasCoords(t);this.hitRegions.handleClick(e,s)&&this.requestRedraw()}),this.canvas.addEventListener("mousemove",t=>{const{x:e,y:s}=this.getCanvasCoords(t),i=this.hitRegions.getCursorAt(e,s);this.canvas.style.cursor=i})}}class Ot{constructor(){this.regions=[]}clear(){this.regions=[]}add(t){this.regions.push(t)}remove(t){this.regions=this.regions.filter(e=>e.id!==t)}removeByPrefix(t){this.regions=this.regions.filter(e=>!e.id.startsWith(t))}hitTest(t,e){for(let s=this.regions.length-1;s>=0;s--){const i=this.regions[s];if(t>=i.x&&t<i.x+i.width&&e>=i.y&&e<i.y+i.height)return i}return null}getCursorAt(t,e){const s=this.hitTest(t,e);return(s==null?void 0:s.cursor)||"default"}handleClick(t,e){const s=this.hitTest(t,e);return s!=null&&s.onClick?(s.onClick(),!0):!1}}const J={cloudAnimation:11,prevIconBg:14,prevIconMask:17,randomizeButtonBg:139,hcTagSmall:22,rotateArrowLeft:25,rotateArrowRight:28,partArrowLeft:31,partArrowLeftReactive:34,partArrowRight:37,partArrowRightReactive:40,partSelected:43,mainMenuMainSelectedBg:46,mainMenuSubSelectedBg:49,arrowSmallLeft:52,arrowSmallLeftReactive:55,arrowSmallRightReactive:58,arrowSmallRight:61,mainMenuMainUnselectedBg:64,mainMenuMain_body_Selected:67,mainMenuMain_body_Unselected:70,mainMenuMain_chest_Selected:73,mainMenuMain_chest_Unselected:76,mainMenuMain_legs_Unselected:79,mainMenuMain_legs_Selected:82,mainMenuMain_head_Unselected:85,mainMenuMain_head_Selected:88,mainMenuSub_sh:91,mainMenuSub_male:94,mainMenuSub_lg:97,mainMenuSub_female:100,mainMenuSub_ha:103,mainMenuSub_hr:106,mainMenuSub_ea:109,mainMenuSub_wa:112,mainMenuSub_ca:115,mainMenuSub_he:118,mainMenuSub_fa:121,mainMenuSub_ch:124,partRemove:127,colorBg:130,colorSelect:133,mainMenuSubGenderSelectedBg:136,floorTile:152};class Nt{constructor(t){this.spriteLoader=t}async loadAll(){const t=Object.values(J).map(e=>`${e}.png`);await this.spriteLoader.preloadUIAssets(t)}get(t){const e=J[t];return e===void 0?null:this.spriteLoader.getUIAsset(`${e}.png`)}getAssetMap(){return J}}const xt=18,$t=0,ot=60,Ht=5,kt=10,Lt=50,nt=46,at=130,Gt=12;class Ut{constructor(t,e,s,i,r,o){this.openedMainIndex=0,this.locationX=t,this.locationY=e,this.uiAssets=s,this.hitRegions=i,this.eventBus=r,this.localization=o,this.openedIndexes=P.map(()=>0)}showMenuIndex(t,e){if(t!==void 0&&(this.openedMainIndex=Math.max(0,Math.min(t,P.length-1))),e!==void 0){const s=P[this.openedMainIndex].items.length-1;this.openedIndexes[this.openedMainIndex]=Math.max(0,Math.min(e,s))}}getMenuMainOpenedIndex(){return this.openedMainIndex}getMenuSubOpenedIndex(){return this.openedIndexes[this.openedMainIndex]}getSelectedSetType(){const t=P[this.openedMainIndex],e=this.openedIndexes[this.openedMainIndex];return t.items[e]}draw(t){this.hitRegions.removeByPrefix("mainmenu_");for(let e=0;e<P.length;e++){const s=P[e],i=this.locationX+xt+e*(ot+Ht),r=this.locationY+$t,o=e===this.openedMainIndex,c=o?"mainMenuMainSelectedBg":"mainMenuMainUnselectedBg",n=this.uiAssets.get(c);n&&t.drawImage(n,i,r);const h=o?"Selected":"Unselected",a=this.uiAssets.get(`mainMenuMain_${s.id}_${h}`);a&&t.drawImage(a,i+12,r+5);const l=e;this.hitRegions.add({id:`mainmenu_main_${e}`,x:i,y:r,width:ot,height:n?n.height:40,cursor:"pointer",onClick:()=>this.mainItemClicked(l)})}this.drawSubMenu(t)}drawSubMenu(t){const e=P[this.openedMainIndex],s=e.items,i=e.type==="gender",r=this.locationY+Lt,o=i?at:nt,c=this.openedIndexes[this.openedMainIndex];for(let n=0;n<s.length;n++){const h=s[n],a=this.locationX+kt+n*(o+Gt),l=n===c;if(i){if(l){const S=this.uiAssets.get("mainMenuSubGenderSelectedBg");S&&t.drawImage(S,a,r)}const d=this.uiAssets.get(`mainMenuSub_${h}`);d&&t.drawImage(d,a+5,r);const u=h==="male"?this.localization.boy:this.localization.girl;t.save(),t.font="bold 12px Verdana",t.fillStyle="#000000",t.textBaseline="middle";const g=a+(d?d.width+10:50),f=r+17;t.fillText(u,g,f),t.restore(),this.hitRegions.add({id:`mainmenu_sub_${n}`,x:a,y:r,width:at,height:35,cursor:"pointer",onClick:()=>this.subItemClicked(n,h)})}else{if(l){const u=this.uiAssets.get("mainMenuSubSelectedBg");u&&t.drawImage(u,a,r)}const d=this.uiAssets.get(`mainMenuSub_${h}`);d&&t.drawImage(d,a+5,r),this.hitRegions.add({id:`mainmenu_sub_${n}`,x:a,y:r,width:nt,height:40,cursor:"pointer",onClick:()=>this.subItemClicked(n,h)})}}}mainItemClicked(t){this.openedMainIndex=t;const e=this.openedIndexes[this.openedMainIndex],s=P[this.openedMainIndex].items[e];this.eventBus.emit("setTypeSelected",{setType:s})}subItemClicked(t,e){this.openedIndexes[this.openedMainIndex]=t,this.eventBus.emit("setTypeSelected",{setType:e})}}const lt=5,Yt=3,ct=9,A=45;class Xt{constructor(t,e,s,i,r,o,c){this.currentSetType="hd",this.currentGender="M",this.currentColor="FFFFFF",this.currentSelectedId=0,this.setIsMandatory=!0,this.pageData=[],this.currentPageIndex=0,this.currentSelectionPageNo=0,this.previewCache=new Map,this.locationX=t,this.locationY=e,this.useClub=s,this.uiAssets=i,this.hitRegions=r,this.eventBus=o,this.previewRenderer=c}showMenu(t,e,s,i,r){this.currentSetType=t,this.currentGender=e,this.currentColor=s||"FDFDFD",this.currentSelectedId=i||0,this.setIsMandatory=r??!0,this.previewCache.clear(),this.currentSelectedId===0&&(this.currentSelectionPageNo=0);const o=b.getInstance().getSetsForSetType(this.currentSetType,this.currentGender,this.useClub,!0);this.pageData=[];let c=0,n=[];const h=lt*Yt;let a=0,l=0;for(;l<o.length;)c===0&&l===0?this.setIsMandatory||(n.push({type:"remove"}),a++):a===0&&c>0&&(n.push({type:"back"}),a++),a===h-1&&l<o.length?(n.push({type:"forward"}),a++):(o[l].getSetId()===i&&(this.currentSelectionPageNo=c),n.push({type:"part",index:l}),l++,a++),l===o.length?this.pageData.push(n):a===h&&(this.pageData.push(n),a=0,n=[],c++);o.length===0&&!this.setIsMandatory&&(this.pageData=[[{type:"remove"}]]),this.currentPageIndex=this.currentSelectionPageNo}setColor(t){this.currentColor=t,this.previewCache.clear()}setSelection(t){this.currentSelectedId=t}clearSelection(){this.currentSelectedId=0}getCurrentSetType(){return this.currentSetType}draw(t){if(this.hitRegions.removeByPrefix("bodypart_"),this.pageData.length===0)return;const e=Math.max(0,Math.min(this.currentPageIndex,this.pageData.length-1)),s=this.pageData[e];if(!s)return;const i=b.getInstance().getSetsForSetType(this.currentSetType,this.currentGender,this.useClub,!0);let r=0,o=0;for(let c=0;c<s.length;c++){const n=this.locationX+r*(A+ct),h=this.locationY+o*(A+ct),a=s[c];if(a.type==="part"&&a.index!==void 0){const l=i[a.index];if(!l){r++;continue}const u=l.getSetId()===this.currentSelectedId;this.drawPartItem(t,l,n,h,u),this.hitRegions.add({id:`bodypart_${c}`,x:n,y:h,width:A,height:A,cursor:"pointer",onClick:()=>{this.eventBus.emit("setSelected",{setId:l.getSetId(),setType:this.currentSetType})}})}else a.type==="remove"?(this.drawRemoveItem(t,n,h,this.currentSelectedId===0),this.hitRegions.add({id:"bodypart_remove",x:n,y:h,width:A,height:A,cursor:"pointer",onClick:()=>{this.eventBus.emit("setSelected",{setId:0,setType:this.currentSetType})}})):a.type==="forward"?(this.drawArrow(t,"Right",n,h),this.hitRegions.add({id:"bodypart_forward",x:n,y:h,width:A,height:A,cursor:"pointer",onClick:()=>{this.currentPageIndex++,this.eventBus.emit("stateChanged")}})):a.type==="back"&&(this.drawArrow(t,"Left",n,h),this.hitRegions.add({id:"bodypart_back",x:n,y:h,width:A,height:A,cursor:"pointer",onClick:()=>{this.currentPageIndex--,this.eventBus.emit("stateChanged")}}));r++,r>=lt&&(r=0,o++)}}drawPartItem(t,e,s,i,r){const o=e.getSetId();if(!this.previewCache.has(o)){const n=this.previewRenderer.renderIcon(e,this.currentColor);this.previewCache.set(o,n)}const c=this.previewCache.get(o);if(t.save(),t.beginPath(),t.rect(s,i,A,A),t.clip(),t.drawImage(c,s,i),t.restore(),r){const n=this.uiAssets.get("partSelected");n&&t.drawImage(n,s-1,i-1)}if(e.isClubOnly()){const n=this.uiAssets.get("hcTagSmall");n&&t.drawImage(n,s+41,i+25)}}drawRemoveItem(t,e,s,i){const r=this.uiAssets.get("partRemove");if(r&&t.drawImage(r,e+10,s-5),i){const o=this.uiAssets.get("partSelected");o&&t.drawImage(o,e-1,s-1)}}drawArrow(t,e,s,i){const r=e==="Right"?"partArrowRight":"partArrowLeft",o=this.uiAssets.get(r);o&&t.drawImage(o,s,i)}}const Y=27,X=27,zt=3,qt=2,ht=9,Wt=4,z=3;class Vt{constructor(t,e,s,i,r){this.currentSelectedId=0,this.targetSetType="hd",this.showClubColors=!1,this.currentPaletteId=1,this.pageData=[],this.currentPageIndex=0,this.currentSelectionPageNo=0,this.locationX=t,this.locationY=e,this.uiAssets=s,this.hitRegions=i,this.eventBus=r}showColorChooser(t,e,s,i){this.currentSelectedId=e||0,this.targetSetType=s,this.showClubColors=i??!1,this.currentPaletteId=t,this.currentSelectionPageNo=0;const r=b.getInstance().getColorsForPaletteId(this.currentPaletteId,this.showClubColors,!0);this.pageData=[];let o=[],c=0;const n=ht*Wt;let h=0,a=0;for(;a<r.length;)h===0&&c>0&&(o.push({type:"back"}),h++),h===n-1&&a<r.length-1?(o.push({type:"forward"}),h++):(r[a].getID()===this.currentSelectedId&&(this.currentSelectionPageNo=c),o.push({type:"color",index:a}),a++,h++),a===r.length?this.pageData.push(o):h===n&&(this.pageData.push(o),h=0,o=[],c++);this.currentPageIndex=this.currentSelectionPageNo}getCurrentSelectedColorId(){return this.currentSelectedId}draw(t){if(this.hitRegions.removeByPrefix("color_"),this.pageData.length===0)return;const e=Math.max(0,Math.min(this.currentPageIndex,this.pageData.length-1)),s=this.pageData[e];if(!s)return;const i=b.getInstance().getColorsForPaletteId(this.currentPaletteId,this.showClubColors,!0);let r=0,o=0;for(let c=0;c<s.length;c++){const n=this.locationX+r*(Y+zt),h=this.locationY+o*(X+qt),a=s[c];if(a.type==="color"&&a.index!==void 0){const l=i[a.index];if(!l){r++;continue}const d=l.getID()===this.currentSelectedId;this.drawColorButton(t,l,n,h,d);const u=l.getID(),g=l.getColorStr();this.hitRegions.add({id:`color_${c}`,x:n,y:h,width:Y,height:X,cursor:"pointer",onClick:()=>{this.currentSelectedId=u,this.eventBus.emit("colorSelected",{colorStr:g,targetSetType:this.targetSetType,colorId:u})}})}else a.type==="forward"?(this.drawSmallArrow(t,"Right",n,h),this.hitRegions.add({id:"color_forward",x:n,y:h,width:Y,height:X,cursor:"pointer",onClick:()=>{this.currentPageIndex++,this.eventBus.emit("stateChanged")}})):a.type==="back"&&(this.drawSmallArrow(t,"Left",n,h),this.hitRegions.add({id:"color_back",x:n,y:h,width:Y,height:X,cursor:"pointer",onClick:()=>{this.currentPageIndex--,this.eventBus.emit("stateChanged")}}));r++,r>=ht&&(r=0,o++)}}drawColorButton(t,e,s,i,r){const o=e.getColorStr(),[c,n,h]=Z(o),a=this.uiAssets.get("colorBg");if(a){const l=document.createElement("canvas");l.width=a.width,l.height=a.height;const d=l.getContext("2d");d.drawImage(a,0,0);const u=d.getImageData(0,0,a.width,a.height),g=u.data,f=c/255,S=n/255,C=h/255;for(let m=0;m<g.length;m+=4)g[m]=Math.round(g[m]*f),g[m+1]=Math.round(g[m+1]*S),g[m+2]=Math.round(g[m+2]*C);d.putImageData(u,0,0),t.drawImage(l,s+z,i+z)}else t.fillStyle=`#${o}`,t.fillRect(s+z,i+z,21,21);if(e.isClubOnly()){const l=this.uiAssets.get("hcTagSmall");l&&t.drawImage(l,s+1,i+1)}if(r){const l=this.uiAssets.get("colorSelect");l&&t.drawImage(l,s,i)}}drawSmallArrow(t,e,s,i){const r=e==="Right"?"arrowSmallRight":"arrowSmallLeft",o=this.uiAssets.get(r);o&&t.drawImage(o,s,i)}}class jt{constructor(t,e,s,i,r,o){this.uiAssets=t,this.hitRegions=e,this.eventBus=s,this.avatarRenderer=i,this.figure=r,this.direction=o}setFigure(t){this.figure=t}setDirection(t){this.direction=t}getDirection(){return this.direction}rotateNext(){this.direction--,this.direction<0&&(this.direction=7)}rotatePrev(){this.direction++,this.direction>7&&(this.direction=0)}draw(t){this.hitRegions.removeByPrefix("avatar_");const e=this.uiAssets.get("floorTile");e&&t.drawImage(e,k+5,V+165),this.avatarRenderer.drawAvatarToCanvas(t,this.figure,this.direction,k,V,st);const s=this.uiAssets.get("rotateArrowLeft"),i=this.uiAssets.get("rotateArrowRight"),r=V+100;if(s){const o=k-20;t.drawImage(s,o,r),this.hitRegions.add({id:"avatar_rotateLeft",x:o,y:r,width:s.width,height:s.height,cursor:"pointer",onClick:()=>{this.rotateNext(),this.eventBus.emit("stateChanged")}})}if(i){const o=k+128+10;t.drawImage(i,o,r),this.hitRegions.add({id:"avatar_rotateRight",x:o,y:r,width:i.width,height:i.height,cursor:"pointer",onClick:()=>{this.rotatePrev(),this.eventBus.emit("stateChanged")}})}}}const K=46,Zt=1e3;class Jt{constructor(t,e,s,i){this.enabled=!0,this.cooldownTimer=null,this.clouds=[],this.cloudAnimationEnd=0,this.animating=!1,this.uiAssets=t,this.hitRegions=e,this.eventBus=s,this.localization=i}draw(t){this.hitRegions.removeByPrefix("randomize_");const e=this.uiAssets.get("randomizeButtonBg");if(e){const s=k+H*st/2,i=Math.round(s-e.width/2);t.drawImage(e,i,K),t.save(),t.font="bold 11px Verdana",t.fillStyle="#000000",t.textAlign="center",t.textBaseline="middle",t.fillText(this.localization.randomize,i+e.width/2,K+e.height/2),t.restore(),this.hitRegions.add({id:"randomize_btn",x:i,y:K,width:e.width,height:e.height,cursor:this.enabled?"pointer":"default",onClick:()=>this.handleClick()})}}drawClouds(t){if(!this.animating)return;const e=Date.now();if(e>=this.cloudAnimationEnd){this.animating=!1,this.clouds=[];return}e-(this.cloudAnimationEnd-700)<350&&Math.random()<.3&&this.clouds.push({x:325+Math.random()*80,y:85+Math.random()*180,alpha:1,startTime:e,scale:.5+Math.random()*1.5});const i=this.uiAssets.get("cloudAnimation");t.save(),t.imageSmoothingEnabled=!1;for(const r of this.clouds){const o=e-r.startTime,c=Math.max(0,1-o/500);if(!(c<=0))if(t.globalAlpha=c,i){const n=i.width*r.scale,h=i.height*r.scale;t.drawImage(i,r.x,r.y,n,h)}else t.fillStyle="#FFFFFF",t.beginPath(),t.arc(r.x+10,r.y+10,10*r.scale,0,Math.PI*2),t.fill()}t.restore()}isAnimating(){return this.animating}handleClick(){this.enabled&&(this.enabled=!1,this.cooldownTimer=window.setTimeout(()=>{this.enabled=!0,this.cooldownTimer=null},Zt),this.animating=!0,this.cloudAnimationEnd=Date.now()+700,this.clouds=[],this.eventBus.emit("randomizeAvatar"))}}const Kt=5e3;class Qt{constructor(){this.initBlockActive=!0,this.editorOkToProceed=!0,this.initBlockTimer=null,this.initBlockTimer=window.setTimeout(()=>{this.initBlockActive=!1,this.setAllowedToProceed(this.editorOkToProceed)},Kt)}setGenderAndFigure(t,e){var s,i;try{(i=(s=window.HabboEditor)==null?void 0:s.setGenderAndFigure)==null||i.call(s,t,e)}catch(r){console.warn("HabboEditor.setGenderAndFigure failed:",r)}}setAllowedToProceed(t){var e,s;if(this.editorOkToProceed=t,!this.initBlockActive)try{(s=(e=window.HabboEditor)==null?void 0:e.setAllowedToProceed)==null||s.call(e,t)}catch(i){console.warn("HabboEditor.setAllowedToProceed failed:",i)}}setEditorState(t){var e,s;try{(s=(e=window.HabboEditor)==null?void 0:e.setEditorState)==null||s.call(e,t)}catch(i){console.warn("HabboEditor.setEditorState failed:",i)}}showHabboClubNotice(){var t,e;try{(e=(t=window.HabboEditor)==null?void 0:t.showHabboClubNotice)==null||e.call(t)}catch(s){console.warn("HabboEditor.showHabboClubNotice failed:",s)}}hideHabboClubNotice(){var t,e;try{(e=(t=window.HabboEditor)==null?void 0:t.hideHabboClubNotice)==null||e.call(t)}catch(s){console.warn("HabboEditor.hideHabboClubNotice failed:",s)}}showOldFigureNotice(){var t,e;try{(e=(t=window.HabboEditor)==null?void 0:t.showOldFigureNotice)==null||e.call(t)}catch(s){console.warn("HabboEditor.showOldFigureNotice failed:",s)}}destroy(){this.initBlockTimer!==null&&clearTimeout(this.initBlockTimer)}}class Q{constructor(t,e){this.config={...ft,...e},this.container=t,this.hitRegions=new Ot,this.state=new Ft(this.config.userHasClub,this.config.showClubSelections),this.spriteLoader=new Tt(this.config.assetsPath),this.avatarRenderer=new Mt(this.spriteLoader),this.previewIconRenderer=new _t(this.spriteLoader),this.bridge=new Qt,this.init()}async init(){const t=this.config.assetsPath,e=t+(t.endsWith("/")?"":"/")+"data/";await Promise.all([b.getInstance().loadFromUrl(e+"figuredata.xml"),L.getInstance().loadFromUrl(e+"draworder.xml"),_.getInstance().loadFromUrl(e+"symbols.csv"),_.getInstance().loadOffsetsFromUrl(e+"spriteoffsets.csv")]);const s=_.getInstance(),i=s.getAllNames().map(o=>s.getFilenameForName(o)).filter(Boolean);await this.spriteLoader.preloadAllSprites(i),console.log(`[HabboEditor] Loaded ${i.length} avatar sprites`),this.uiAssets=new Nt(this.spriteLoader),await this.uiAssets.loadAll(),console.log("[HabboEditor] UI assets loaded"),this.initFigure(),console.log(`[HabboEditor] Figure: ${this.state.figure.getFigureString()} gender=${this.state.figure.getGender()}`),this.createUI(),this.canvasManager.setDrawCallback(()=>this.drawAll()),this.canvasManager.startContinuousRender(),this.bridge.setGenderAndFigure(this.state.figure.getGender(),this.state.figure.getFigureString()),this.checkClubSetsStatus()&&this.bridge.setAllowedToProceed(!1),this.config.menuState&&this.updatePartAndColorMenu(this.config.menuState)}initFigure(){const t=this.config.figure,e=this.config.gender;if(!t||!e||t===""||e===""){const s=!e||e===""?"U":e;this.state.figure=new E,this.state.figure.randomizeFigure(s,this.config.userHasClub&&this.config.showClubSelections)}else this.state.figure=new E(e),this.state.figure.parseFigureString(t)||this.bridge.showOldFigureNotice();this.state.storedFemaleFigure=new E("F"),this.state.storedMaleFigure=new E("M")}createUI(){this.canvasManager=new Et(this.container,this.hitRegions),this.mainMenu=new Ut(0,0,this.uiAssets,this.hitRegions,this.state.eventBus,this.config.localization);const t=this.state.figure.getGender()==="F"?1:0;this.mainMenu.showMenuIndex(0,t),this.bodyPartMenu=new Xt(18,100,this.config.showClubSelections,this.uiAssets,this.hitRegions,this.state.eventBus,this.previewIconRenderer),this.initBodyPartMenu();const s=100+3*45+2*9+6+4+9;this.colorChooser=new Vt(18,s,this.uiAssets,this.hitRegions,this.state.eventBus),this.initColorChooser(),this.avatarDisplay=new jt(this.uiAssets,this.hitRegions,this.state.eventBus,this.avatarRenderer,this.state.figure,this.state.avatarDirection),this.randomizeButton=new Jt(this.uiAssets,this.hitRegions,this.state.eventBus,this.config.localization),this.wireEvents()}initBodyPartMenu(){const t=b.getInstance(),e=this.state.figure.getSetTypeColorId(v),s=t.getColorData(e),i=s?s.getColorStr():"FFFFFF",r=this.state.figure.getSetItemByType(v),o=r?r.getSetId():0,c=t.isSetTypeMandatory(v);this.bodyPartMenu.showMenu(v,this.state.figure.getGender(),i,o,c)}initColorChooser(){const e=b.getInstance().getPaletteIdForSetType(v),s=this.state.figure.getSetTypeColorId(v);this.colorChooser.showColorChooser(e,s,v,this.config.showClubSelections)}wireEvents(){const t=this.state.eventBus;t.on("setTypeSelected",e=>{this.handleSetTypeSelection(e)}),t.on("setSelected",e=>{this.handleSetSelection(e)}),t.on("colorSelected",e=>{this.handleColorSelection(e)}),t.on("randomizeAvatar",()=>{this.handleRandomize()}),t.on("stateChanged",()=>{this.canvasManager.requestRedraw()})}handleSetTypeSelection(t){let e=t.setType;const s=this.state.figure.getGender();let i=s;if((e==="male"||e==="female")&&(i=e==="male"?"M":"F",e="hd"),s!==i){const a=this.state.figure.getFigureString();i==="M"?(this.state.storedFemaleFigure.parseFigureString(a),this.state.figure.setGender(i),this.state.figure.parseFigureString(this.state.storedMaleFigure.getFigureString())):(this.state.storedMaleFigure.parseFigureString(a),this.state.figure.setGender(i),this.state.figure.parseFigureString(this.state.storedFemaleFigure.getFigureString())),this.state.figure.getFigureString().length===0&&(this.state.figure.randomizeFigure(i,this.config.userHasClub&&this.config.showClubSelections),this.checkClubSetsStatus()),this.bridge.setGenderAndFigure(this.state.figure.getGender(),this.state.figure.getFigureString()),this.bridge.setAllowedToProceed(!0)}this.state.currentSetType=e;const r=b.getInstance(),o=r.isSetTypeMandatory(e),c=r.getPaletteIdForSetType(e),n=this.state.figure.getSetItemByType(e);if(n){const a=n.getSetId(),l=n.getColorId(),d=r.getColorData(l),u=d?d.getColorStr():"FFFFFF";this.colorChooser.showColorChooser(c,l,e,this.config.showClubSelections),this.bodyPartMenu.showMenu(e,i,u,a,o)}else{const a=r.getColorsForPaletteId(c,this.config.userHasClub,!0),l=a.length>0?a[0].getID():0,d=a.length>0?a[0].getColorStr():"FFFFFF";this.colorChooser.showColorChooser(c,l,e,this.config.showClubSelections),this.bodyPartMenu.showMenu(e,i,d,0,o)}this.avatarDisplay.setFigure(this.state.figure);const h=`${e}-${this.mainMenu.getMenuMainOpenedIndex()}-${this.mainMenu.getMenuSubOpenedIndex()}`;this.bridge.setEditorState(h),this.canvasManager.requestRedraw()}handleSetSelection(t){const e=b.getInstance(),s=t.setType;let i=t.setId,r=!0;const o=e.getPaletteIdForSetType(s);let c=this.state.figure.getSetTypeColorId(s);if((c===void 0||c===-1)&&(c=this.colorChooser.getCurrentSelectedColorId()),c===void 0||c===-1){const l=e.getColorsForPaletteId(o);l.length>0&&(c=l[0].getID(),this.colorChooser.showColorChooser(o,c,s,this.config.showClubSelections))}const n=e.getColorData(c),h=n?n.getColorStr():"FFFFFF",a=this.state.figure.getSetItemByType(s);a&&i===a.getSetId()&&(e.isSetTypeMandatory(s)||(i=0,r=!1,this.bodyPartMenu.clearSelection())),i===0?this.state.figure.removeSetItemByType(s):this.state.figure.setSetItem(s,i,c),r&&(this.bodyPartMenu.setSelection(i),this.bodyPartMenu.setColor(h)),this.bridge.setGenderAndFigure(this.state.figure.getGender(),this.state.figure.getFigureString()),this.avatarDisplay.setFigure(this.state.figure),this.checkClubSetsStatus(),this.canvasManager.requestRedraw()}handleColorSelection(t){const e=t.colorStr,s=t.targetSetType,i=t.colorId;this.bodyPartMenu.setColor(e),this.state.figure.setSetTypeColor(s,i),this.bridge.setGenderAndFigure(this.state.figure.getGender(),this.state.figure.getFigureString()),this.avatarDisplay.setFigure(this.state.figure),this.checkClubSetsStatus(),this.canvasManager.requestRedraw()}handleRandomize(){this.state.figure.randomizeFigure(this.state.figure.getGender(),this.config.userHasClub&&this.config.showClubSelections),this.bridge.setGenderAndFigure(this.state.figure.getGender(),this.state.figure.getFigureString()),this.avatarDisplay.setFigure(this.state.figure),this.updatePartAndColorMenu(),this.canvasManager.requestRedraw()}updatePartAndColorMenu(t){const e=b.getInstance();let s=this.bodyPartMenu.getCurrentSetType();if(t){const l=t.split("-"),d=l[0],u=parseInt(l[1],10),g=parseInt(l[2],10);this.mainMenu.showMenuIndex(u,g);const f=e.getSetTypes();for(const[S]of f)if(S===d){s=d;break}}const i=this.state.figure.getGender(),r=e.isSetTypeMandatory(s),o=e.getPaletteIdForSetType(s),c=this.state.figure.getSetItemByType(s);let n,h,a;if(c){n=c.getSetId(),h=c.getColorId();const l=e.getColorData(h);a=l?l.getColorStr():"FFFFFF"}else{n=0;const l=e.getColorsForPaletteId(o,this.config.userHasClub,!0);h=l.length>0?l[0].getID():0,a=l.length>0?l[0].getColorStr():"FFFFFF"}this.colorChooser.showColorChooser(o,h,s,this.config.showClubSelections),this.bodyPartMenu.showMenu(s,i,a,n,r),this.checkClubSetsStatus(),this.avatarDisplay.setFigure(this.state.figure)}checkClubSetsStatus(){return this.state.figure.getClubSets().length>0&&!this.config.userHasClub?(this.bridge.setAllowedToProceed(!1),this.bridge.showHabboClubNotice(),!1):this.state.figure.getClubColors().length>0&&!this.config.userHasClub?(this.bridge.setAllowedToProceed(!1),this.bridge.showHabboClubNotice(),!1):(this.bridge.setAllowedToProceed(!0),this.bridge.hideHabboClubNotice(),!0)}drawBorders(t){t.beginPath(),t.moveTo(11,50),t.lineTo(286,50),t.arcTo(294,50,294,58,8),t.lineTo(294,82),t.arcTo(294,90,286,90,8),t.lineTo(11,90),t.arcTo(3,90,3,82,8),t.lineTo(3,58),t.arcTo(3,50,11,50,8),t.closePath(),t.fillStyle="#E5E3E1",t.fill(),t.beginPath(),t.moveTo(11,47),t.lineTo(286,47),t.arcTo(294,47,294,55,8),t.lineTo(294,251),t.arcTo(294,259,286,259,8),t.lineTo(11,259),t.arcTo(3,259,3,251,8),t.lineTo(3,55),t.arcTo(3,47,11,47,8),t.closePath(),t.strokeStyle="#FFCC00",t.lineWidth=3,t.stroke();const p=3,F=291,R=272,D=4*27+3*2,$=R-9,M=9+D+9,y=$;t.beginPath(),t.moveTo(128,y),t.lineTo(140,y-8),t.lineTo(152,y),t.closePath(),t.fillStyle="#FFFFFF",t.fill(),t.beginPath(),t.moveTo(p+8,y),t.lineTo(128,y),t.lineTo(140,y-8),t.lineTo(152,y),t.lineTo(p+F-8,y),t.arcTo(p+F,y,p+F,y+8,8),t.lineTo(p+F,y+M-8),t.arcTo(p+F,y+M,p+F-8,y+M,8),t.lineTo(p+8,y+M),t.arcTo(p,y+M,p,y+M-8,8),t.lineTo(p,y+8),t.arcTo(p,y,p+8,y,8),t.closePath(),t.strokeStyle="#000000",t.lineWidth=2,t.stroke()}drawAll(){const t=this.canvasManager.ctx;this.drawBorders(t),this.avatarDisplay.draw(t),this.randomizeButton.draw(t),this.mainMenu.draw(t),this.bodyPartMenu.draw(t),this.colorChooser.draw(t),this.randomizeButton.drawClouds(t)}getFigureString(){return this.state.figure.getFigureString()}getGender(){return this.state.figure.getGender()}}window.HabboAvatarEditor=Q;const dt=document.getElementById("editor-container");dt&&new Q(dt,{figure:"hd-180-1.ch-215-82.lg-270-82",gender:"M",userHasClub:!1,showClubSelections:!0,assetsPath:""}),et.HabboAvatarEditor=Q,Object.defineProperty(et,Symbol.toStringTag,{value:"Module"})})(this.HabboAvatarEditor=this.HabboAvatarEditor||{});
