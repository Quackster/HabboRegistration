(function(et){"use strict";const ft={figure:"",gender:"U",userHasClub:!1,showClubSelections:!0,assetsPath:"",localization:{randomize:"Randomize",boy:"Boy",girl:"Girl"}},Y=495,z=400,$=64,D=106,x=68,st=2,k=323,q=70,pt=4,v="hd",mt=[0,1,2,3,2,1,0,7],P=[{id:"body",type:"gender",items:["male","female"]},{id:"head",type:"part",items:["hr","ha","he","ea","fa"]},{id:"chest",type:"part",items:["ch","ca"]},{id:"legs",type:"part",items:["lg","sh","wa"]}];class It{constructor(t,e,s,i,o,r,c,a,h){this.setId=t,this.setType=e,this.paletteId=s,this.gender=i,this.clubOnly=r,this.selectable=c,this.colorable=a,this.parts=o,this.hiddenLayers=h}getSetId(){return this.setId}getSetType(){return this.setType}getPaletteId(){return this.paletteId}getGender(){return this.gender}isClubOnly(){return this.clubOnly}isSelectable(){return this.selectable}isColorable(){return this.colorable}getParts(){return this.parts}getHiddenLayers(){return this.hiddenLayers}}class St{constructor(t,e,s,i,o,r){this.paletteId=t,this.color=e,this.id=s,this.index=i,this.clubOnly=o,this.selectable=r}getPaletteId(){return this.paletteId}getColorStr(){return this.color}getID(){return this.id}getIndex(){return this.index}isClubOnly(){return this.clubOnly}isSelectable(){return this.selectable}}class yt{constructor(t,e,s){this.partId=t,this.partType=e,this.colorable=s}getPartId(){return this.partId}getPartType(){return this.partType}isPartColorable(){return this.colorable}}const E=class E{constructor(){this.setTypeArr=[],this.setArr=[],this.paletteArr=[],this.loaded=!1}static getInstance(){return E.instance||(E.instance=new E),E.instance}async loadFromUrl(t){const e=await fetch(t);if(!e.ok){console.error(`[FigureData] Failed to load: ${t} (${e.status})`);return}const s=await e.text(),o=new DOMParser().parseFromString(s,"text/xml");this.parseXml(o),console.log(`[FigureData] Loaded ${this.setArr.length} sets, ${this.paletteArr.length} colors, ${this.setTypeArr.length} set types`)}parseXml(t){const e=t.querySelector("figuredata");if(!e)return;const s=e.querySelector("sets");s&&this.parseSets(s);const i=e.querySelector("colors");i&&this.parseColors(i),this.loaded=!0}isLoaded(){return this.loaded}getSetTypes(){return this.setTypeArr}getSetForId(t){for(const e of this.setArr)if(e.getSetId()===t)return e;return null}getSetsForSetType(t,e,s=!0,i=!0){const o=[];for(const r of this.setArr)i&&!r.isSelectable()||r.getSetType()===t&&(r.getGender()!==e&&r.getGender()!=="U"||!s&&r.isClubOnly()||o.push(r));return o}getPaletteIdForSetType(t){for(const e of this.setArr)if(e.getSetType()===t)return e.getPaletteId();return 1}getPartsForSetId(t){for(const e of this.setArr)if(e.getSetId()===t)return e.getParts();return[]}getColorsForPaletteId(t,e=!0,s=!0){const i=[];for(const o of this.paletteArr)s&&!o.isSelectable()||o.getPaletteId()===t&&(!e&&o.isClubOnly()||i.push(o));return i}getColorData(t){for(const e of this.paletteArr)if(e.getID()===t)return e;return null}isSetTypeMandatory(t){for(const[e,s]of this.setTypeArr)if(e===t)return s;return!1}parseColors(t){this.paletteArr=[];const e=t.querySelectorAll("palette");for(const s of e){const i=parseInt(s.getAttribute("id")||"0",10),o=s.querySelectorAll("color");for(const r of o){const c=parseInt(r.getAttribute("id")||"0",10),a=parseInt(r.getAttribute("index")||"0",10),h=r.getAttribute("club")==="1",l=r.getAttribute("selectable")==="1",n=r.textContent||"FFFFFF";this.paletteArr.push(new St(i,n,c,a,h,l))}}}parseSets(t){this.setArr=[],this.setTypeArr=[];const e=t.querySelectorAll("settype");for(const s of e){const i=s.getAttribute("type")||"",o=parseInt(s.getAttribute("paletteid")||"0",10),r=s.getAttribute("mandatory")==="1";this.setTypeArr.push([i,r]);const c=s.querySelectorAll("set");for(const a of c){const h=parseInt(a.getAttribute("id")||"0",10),l=a.getAttribute("gender")||"U",n=a.getAttribute("club")==="1",d=a.getAttribute("colorable")==="1",u=a.getAttribute("selectable"),g=u===null?!0:u==="1",p=[],I=a.querySelectorAll(":scope > part");for(const f of I){const b=parseInt(f.getAttribute("id")||"0",10),F=f.getAttribute("type")||"",M=f.getAttribute("colorable")==="1";p.push(new yt(b,F,M))}const w=[],m=a.querySelector("hiddenlayers");if(m){const f=m.querySelectorAll("layer");for(const b of f){const F=b.getAttribute("parttype")||"";w.push(F)}}this.setArr.push(new It(h,i,o,l,p,n,g,d,w))}}}};E.instance=null;let C=E;const O=class O{constructor(){this.drawOrderData={},this.loaded=!1}static getInstance(){return O.instance||(O.instance=new O),O.instance}async loadFromUrl(t){const e=await fetch(t);if(!e.ok){console.error(`[DrawOrder] Failed to load: ${t} (${e.status})`);return}const s=await e.text(),o=new DOMParser().parseFromString(s,"text/xml");this.parseXml(o);const r=Object.keys(this.drawOrderData).length;console.log(`[DrawOrder] Loaded ${r} actions`)}parseXml(t){const e=t.querySelectorAll("action");for(const s of e){const i=s.getAttribute("id")||"std";this.drawOrderData[i]={};const o=s.querySelectorAll("direction");for(const r of o){const c=r.getAttribute("id")||"0",a=[],h=r.querySelectorAll("part");for(const l of h){const n=l.getAttribute("set-type")||"";a.push(n)}this.drawOrderData[i][c]=a}}this.loaded=!0}isLoaded(){return this.loaded}getOrderArray(t,e){const i=this.drawOrderData["std"];if(!i)return[];const o=i[String(t)];return o||[]}};O.instance=null;let H=O;const N=class N{constructor(){this.nameToFileId=new Map,this.imageOffsets=new Map,this.loaded=!1}static getInstance(){return N.instance||(N.instance=new N),N.instance}async loadFromUrl(t){const e=await fetch(t);if(!e.ok){console.error(`[SymbolMap] Failed to load symbols CSV: ${t} (${e.status})`);return}const s=await e.text();this.parseCsv(s),console.log(`[SymbolMap] Loaded ${this.nameToFileId.size} symbol entries`)}async loadOffsetsFromUrl(t){const e=await fetch(t);if(!e.ok){console.error(`[SymbolMap] Failed to load offsets CSV: ${t} (${e.status})`);return}const s=await e.text();this.parseOffsets(s),console.log(`[SymbolMap] Loaded ${this.imageOffsets.size} sprite offsets`)}parseCsv(t){const e=t.trim().split(`
`);for(const s of e){const i=s.trim();if(!i)continue;const[o,r]=i.split(";");if(!r)continue;const a=parseInt(o,10)-2;this.nameToFileId.set(r.trim(),a)}this.loaded=!0}parseOffsets(t){const e=t.trim().split(`
`);for(const s of e){const i=s.trim();if(!i)continue;const o=i.split(";");if(o.length<3)continue;const r=parseInt(o[0],10),c=parseFloat(o[1]),a=parseFloat(o[2]);this.imageOffsets.set(r,{x:c,y:a})}}isLoaded(){return this.loaded}getFileIdForName(t){return this.nameToFileId.get(t)??null}getFilenameForName(t){const e=this.getFileIdForName(t);return e===null?null:`${e}.png`}getOffsetForImageId(t){return this.imageOffsets.get(t)??{x:0,y:0}}getOffsetForName(t){const e=this.getFileIdForName(t);return e===null?{x:0,y:0}:this.getOffsetForImageId(e)}getAllNames(){return Array.from(this.nameToFileId.keys())}};N.instance=null;let _=N;class bt{constructor(t,e,s){this.setType=t,this.setId=e,this.colorId=s}setValues(t,e,s){this.setType=t,this.setId=e,this.colorId=s}getSetType(){return this.setType}getSetId(){return this.setId}getColorId(){return this.colorId}}const it=".",W="-",wt=[["M","hr",97],["M","ha",40],["M","he",15],["M","ea",30],["M","fa",15],["M","ca",10],["M","wa",40],["M","sh",95],["F","hr",100],["F","ha",40],["F","he",25],["F","ea",15],["F","fa",8],["F","ca",15],["F","wa",40],["F","sh",95]];class B{constructor(t,e){this.figureData=[],this.gender="M",t&&this.setGender(t),e&&this.parseFigureString(e)}setGender(t){switch(t.toLowerCase()){case"m":case"male":this.gender="M";break;case"f":case"female":this.gender="F";break;default:this.gender=t.toUpperCase()}}getGender(){return this.gender}getFigureData(){return this.figureData}parseFigureString(t){if(this.figureData=[],!t||t.length===0)return!1;const e=C.getInstance(),s=t.split(it);let i=!0;for(const r of s){const c=r.split(W);if(c.length!==3)return this.figureData=[],!1;let a=c[0],h=parseInt(c[1],10),l=parseInt(c[2],10)||0;const n=e.getSetForId(h);if(n&&n.isSelectable()){if(n.isColorable()&&l>0){const d=e.getColorData(l);if(d&&!(d.getPaletteId()===n.getPaletteId())){const g=e.getColorsForPaletteId(n.getPaletteId(),!1,!0);g.length>0&&(l=g[0].getID(),i=!1)}}}else{const d=e.getSetsForSetType(a,this.gender,!1,!0);if(d.length>0){const u=d[0];h=u.getSetId();const g=e.getColorsForPaletteId(u.getPaletteId(),!1,!0);g.length>0&&(l=g[0].getID()),i=!1}}this.setSetItem(a,h,l)}return this.validateAndFixFigure()&&i}getFigureString(){const t=C.getInstance(),e=[];for(const s of this.figureData){const i=s.getSetType(),o=s.getSetId(),r=s.getColorId(),c=t.getSetForId(o);let a="";c&&c.isColorable()&&(a=String(r)),e.push(`${i}${W}${o}${W}${a}`)}return e.join(it)}setSetItem(t,e,s){for(const i of this.figureData)if(i.getSetType()===t){i.setValues(t,e,s);return}this.figureData.push(new bt(t,e,s))}removeSetItemByType(t){const e=this.figureData.findIndex(s=>s.getSetType()===t);e!==-1&&this.figureData.splice(e,1)}setSetTypeColor(t,e){for(const s of this.figureData)s.getSetType()===t&&s.setValues(t,s.getSetId(),e)}getSetItemById(t){for(const e of this.figureData)if(e.getSetId()===t)return e;return null}getSetItemByType(t){for(const e of this.figureData)if(e.getSetType()===t)return e;return null}getSetTypeColorId(t){const e=this.getSetItemByType(t);return e?e.getColorId():-1}getClubColors(){const t=C.getInstance(),e=[];for(const s of this.figureData){const i=t.getColorData(s.getColorId());i&&i.isClubOnly()&&e.push({colorData:i})}return e}getClubSets(){const t=C.getInstance(),e=[];for(const s of this.figureData){const i=t.getSetForId(s.getSetId());i&&i.isClubOnly()&&e.push({setData:i})}return e}randomizeFigure(t,e=!1){this.figureData=[];let s=t;t==="U"&&(s=Math.random()<.5?"M":"F"),this.setGender(s);const i=C.getInstance(),o=i.getSetTypes();for(const[r,c]of o){const a=this.getSetTypeProbability(r),h=Math.floor(Math.random()*100)<=a;if(c||h){const l=i.getSetsForSetType(r,this.gender,e,!0);if(l.length===0)continue;const n=l[Math.floor(Math.random()*l.length)],d=n.getPaletteId();let u=i.getColorsForPaletteId(d,e,!0);if(r==="hd"&&(u=u.slice(0,10)),u.length===0)continue;const g=Math.floor(Math.random()*u.length),p=u[g].getID();this.setSetItem(r,n.getSetId(),p)}}}getSetTypeProbability(t){for(const[e,s,i]of wt)if(e===this.gender&&s===t)return i;return 30}validateAndFixFigure(){const t=C.getInstance(),e=[];let s=!0;for(const i of this.figureData){const o=i.getSetType(),r=i.getSetId(),c=t.getSetForId(r);if(!c||!c.isSelectable()){const a=t.getSetsForSetType(o,this.gender,!1,!0);a.length>0&&e.push({setType:a[0].getSetType(),setId:a[0].getSetId(),paletteId:a[0].getPaletteId()})}else{const a=i.getColorId(),h=t.getColorData(a);if(h&&!h.isSelectable()){const l=h.getPaletteId(),n=t.getColorsForPaletteId(l,!1,!0);n.length>0&&(this.setSetItem(o,r,n[0].getID()),s=!1)}}}for(const i of e){const o=t.getColorsForPaletteId(i.paletteId,!1,!0),r=o.length>0?o[0].getID():0;this.setSetItem(i.setType,i.setId,r),s=!1}return s}}class Ct{constructor(){this.listeners=new Map}on(t,e){this.listeners.has(t)||this.listeners.set(t,[]),this.listeners.get(t).push(e)}off(t,e){const s=this.listeners.get(t);if(s){const i=s.indexOf(e);i!==-1&&s.splice(i,1)}}emit(t,e){const s=this.listeners.get(t);if(s)for(const i of s)i(e)}}class Ft{constructor(t,e){this.mainMenuIndex=0,this.subMenuIndex=0,this.currentSetType=v,this.bodyPartPage=0,this.colorPage=0,this.avatarDirection=pt,this.userHasClub=t,this.showClubSelections=e,this.figure=new B,this.storedMaleFigure=new B("M"),this.storedFemaleFigure=new B("F"),this.eventBus=new Ct}}class Tt{constructor(t){this.spriteCache=new Map,this.uiCache=new Map,this.assetsPath=t.endsWith("/")?t:t+"/"}loadImage(t){return new Promise((e,s)=>{const i=new Image;i.onload=()=>e(i),i.onerror=()=>s(new Error(`Failed to load: ${t}`)),i.src=t})}async loadSprite(t){if(this.spriteCache.has(t))return this.spriteCache.get(t);const e=await this.loadImage(`${this.assetsPath}sprites/${t}`);return this.spriteCache.set(t,e),e}async loadUIAsset(t){if(this.uiCache.has(t))return this.uiCache.get(t);const e=await this.loadImage(`${this.assetsPath}ui/${t}`);return this.uiCache.set(t,e),e}getSprite(t){return this.spriteCache.get(t)||null}getUIAsset(t){return this.uiCache.get(t)||null}async preloadAllSprites(t,e){let s=0;const i=t.length,o=t.map(async r=>{try{await this.loadSprite(r)}catch{}s++,e==null||e(s,i)});await Promise.all(o)}async preloadUIAssets(t,e){let s=0;const i=t.length,o=t.map(async r=>{try{await this.loadUIAsset(r)}catch{}s++,e==null||e(s,i)});await Promise.all(o)}}function ot(S,t,e,s,i,o,r,c,a){const h=t.width,l=t.height;if(e===255&&s===255&&i===255){S.drawImage(t,o,r,h,l);return}const n=document.createElement("canvas");n.width=h,n.height=l;const d=n.getContext("2d");d.drawImage(t,0,0,h,l);const u=d.getImageData(0,0,h,l),g=u.data,p=e/255,I=s/255,w=i/255;for(let m=0;m<g.length;m+=4)g[m]=Math.round(g[m]*p),g[m+1]=Math.round(g[m+1]*I),g[m+2]=Math.round(g[m+2]*w);d.putImageData(u,0,0),S.drawImage(n,o,r)}function V(S){const t=S.replace("#",""),e=parseInt(t.substring(0,2),16)||0,s=parseInt(t.substring(2,4),16)||0,i=parseInt(t.substring(4,6),16)||0;return[e,s,i]}const At=98;class Mt{constructor(t){this.debugLogDone=!1,this.spriteLoader=t}collectParts(t){const e=C.getInstance(),s=new Map,i=[];for(const o of t.getFigureData()){const r=o.getSetId(),c=o.getColorId(),a=e.getColorData(c),h=a?a.getColorStr():"FFFFFF",l=e.getSetForId(r);if(l){i.push(...l.getHiddenLayers());for(const n of e.getPartsForSetId(r)){const d=n.getPartType();s.has(d)||s.set(d,[]),s.get(d).push({partType:d,partId:n.getPartId(),colorStr:h,colorable:n.isPartColorable()})}}}return s.has("hrb")&&!i.includes("hrb")&&i.push("hr"),{partsMap:s,hiddenLayers:i}}drawAvatarToCanvas(t,e,s,i,o,r){const c=H.getInstance(),a=_.getInstance(),h=mt[s],l=s!==h;let n=c.getOrderArray(h,"std");n.length===0&&(n=["li","lh","ls","bd","sh","lg","ch","wa","hd","fc","ey","hr","hrb","ri","rh","rs","ea","ca","fa","ha","he"]);const{partsMap:d,hiddenLayers:u}=this.collectParts(e),g=!this.debugLogDone;g&&(this.debugLogDone=!0,console.log(`[AvatarRenderer] Direction=${s}, flipDir=${h}, needsFlip=${l}`),console.log(`[AvatarRenderer] Draw order (${n.length} layers):`,n.join(", ")),console.log("[AvatarRenderer] Parts available:",Array.from(d.keys()).join(", ")),console.log("[AvatarRenderer] Hidden layers:",u.join(", ")||"(none)"));const p=document.createElement("canvas");p.width=$,p.height=D;const I=p.getContext("2d");let w=0;for(const f of n){if(u.includes(f))continue;const b=d.get(f);if(b)for(const F of b){const M=`h_std_${F.partType}_${F.partId}_${h}_0`,R=a.getFilenameForName(M);if(!R){g&&console.warn(`[AvatarRenderer] No sprite found for: ${M}`);continue}const T=this.spriteLoader.getSprite(R);if(!T){g&&console.warn(`[AvatarRenderer] Sprite not loaded: ${R} (${M})`);continue}const y=a.getOffsetForName(M);let[K,Q,tt]=[255,255,255];F.partType!=="ey"&&F.colorable&&([K,Q,tt]=V(F.colorStr));const gt=y.x,ut=y.y+At;g&&console.log(`[AvatarRenderer]   ${F.partType}:${F.partId} -> ${R} offset=(${y.x}, ${y.y}) draw=(${gt}, ${ut}) img=${T.width}x${T.height} color=${F.colorStr} tint=(${K},${Q},${tt})`),ot(I,T,K,Q,tt,gt,ut),w++}}g&&(console.log(`[AvatarRenderer] Rendered ${w} sprites to ${$}x${D} offscreen canvas`),console.log(`[AvatarRenderer] Drawing at screen (${i}, ${o}) scale=${r} -> ${$*r}x${D*r}`));const m=t.imageSmoothingEnabled;if(t.imageSmoothingEnabled=!1,l){const f=document.createElement("canvas");f.width=x,f.height=D;const b=f.getContext("2d");b.translate(x,0),b.scale(-1,1),b.drawImage(p,0,0),t.drawImage(f,0,0,x,D,i,o,x*r,D*r)}else t.drawImage(p,i,o,$*r,D*r);t.imageSmoothingEnabled=m}}const vt={hr:83,ha:82,he:82,ea:75,fa:72,hd:78,ch:53,ca:53,wa:43,lg:32,sh:23},Pt=-95,Rt={hr:1,ha:0,he:0,ea:-3,fa:-4,hd:0,ch:0,ca:0,wa:0,lg:0,sh:-2},Dt=-9,_t=98,L=45;class Bt{constructor(t){this.spriteLoader=t}renderIcon(t,e){const s=document.createElement("canvas");s.width=L,s.height=L;const i=s.getContext("2d"),o=_.getInstance(),r=H.getInstance(),c=t.getSetType(),a=t.getParts(),h=2,l=r.getOrderArray(h,"std"),n=new Set(["bd","lh","rh"]),d=[];for(const p of a){const I=p.getPartType();if(n.has(I))continue;const w=l.indexOf(I);d.push({partType:I,partId:p.getPartId(),colorable:p.isPartColorable(),depth:w>=0?w:999})}d.sort((p,I)=>p.depth-I.depth);const u=(vt[c]??50)+Pt,g=(Rt[c]??0)+Dt;i.save(),i.beginPath(),i.rect(0,0,L,L),i.clip();for(const p of d){const I=`h_std_${p.partType}_${p.partId}_${h}_0`,w=o.getFilenameForName(I);if(!w)continue;const m=this.spriteLoader.getSprite(w);if(!m)continue;const f=o.getOffsetForName(I);let[b,F,M]=[255,255,255];p.partType!=="ey"&&p.colorable&&([b,F,M]=V(e));const R=f.x+g,T=f.y+_t+u;ot(i,m,b,F,M,R,T)}return i.restore(),s}}class Et{constructor(t,e){this.drawCallback=null,this.animationFrameId=null,this.needsRedraw=!0,this.hitRegions=e,this.canvas=document.createElement("canvas"),this.canvas.width=Y,this.canvas.height=z,this.canvas.style.display="block",this.ctx=this.canvas.getContext("2d"),t.appendChild(this.canvas),this.setupEventListeners()}setDrawCallback(t){this.drawCallback=t}requestRedraw(){this.needsRedraw=!0}startRenderLoop(){const t=()=>{var e;this.needsRedraw&&(this.needsRedraw=!1,this.clear(),(e=this.drawCallback)==null||e.call(this)),this.animationFrameId=requestAnimationFrame(t)};this.animationFrameId=requestAnimationFrame(t)}startContinuousRender(){const t=()=>{var e;this.clear(),(e=this.drawCallback)==null||e.call(this),this.animationFrameId=requestAnimationFrame(t)};this.animationFrameId=requestAnimationFrame(t)}stopRenderLoop(){this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}clear(){this.ctx.fillStyle="#FFFFFF",this.ctx.fillRect(0,0,Y,z)}getCanvasCoords(t){const e=this.canvas.getBoundingClientRect(),s=Y/e.width,i=z/e.height;return{x:(t.clientX-e.left)*s,y:(t.clientY-e.top)*i}}setupEventListeners(){this.canvas.addEventListener("click",t=>{const{x:e,y:s}=this.getCanvasCoords(t);this.hitRegions.handleClick(e,s)&&this.requestRedraw()}),this.canvas.addEventListener("mousemove",t=>{const{x:e,y:s}=this.getCanvasCoords(t),i=this.hitRegions.getCursorAt(e,s);this.canvas.style.cursor=i})}}class Ot{constructor(){this.regions=[]}clear(){this.regions=[]}add(t){this.regions.push(t)}remove(t){this.regions=this.regions.filter(e=>e.id!==t)}removeByPrefix(t){this.regions=this.regions.filter(e=>!e.id.startsWith(t))}hitTest(t,e){for(let s=this.regions.length-1;s>=0;s--){const i=this.regions[s];if(t>=i.x&&t<i.x+i.width&&e>=i.y&&e<i.y+i.height)return i}return null}getCursorAt(t,e){const s=this.hitTest(t,e);return(s==null?void 0:s.cursor)||"default"}handleClick(t,e){const s=this.hitTest(t,e);return s!=null&&s.onClick?(s.onClick(),!0):!1}}const j={cloudAnimation:11,prevIconBg:14,prevIconMask:17,randomizeButtonBg:139,hcTagSmall:22,rotateArrowLeft:25,rotateArrowRight:28,partArrowLeft:31,partArrowLeftReactive:34,partArrowRight:37,partArrowRightReactive:40,partSelected:43,mainMenuMainSelectedBg:46,mainMenuSubSelectedBg:49,arrowSmallLeft:52,arrowSmallLeftReactive:55,arrowSmallRightReactive:58,arrowSmallRight:61,mainMenuMainUnselectedBg:64,mainMenuMain_body_Selected:67,mainMenuMain_body_Unselected:70,mainMenuMain_chest_Selected:73,mainMenuMain_chest_Unselected:76,mainMenuMain_legs_Unselected:79,mainMenuMain_legs_Selected:82,mainMenuMain_head_Unselected:85,mainMenuMain_head_Selected:88,mainMenuSub_sh:91,mainMenuSub_male:94,mainMenuSub_lg:97,mainMenuSub_female:100,mainMenuSub_ha:103,mainMenuSub_hr:106,mainMenuSub_ea:109,mainMenuSub_wa:112,mainMenuSub_ca:115,mainMenuSub_he:118,mainMenuSub_fa:121,mainMenuSub_ch:124,partRemove:127,colorBg:130,colorSelect:133,mainMenuSubGenderSelectedBg:136,floorTile:152};class Nt{constructor(t){this.spriteLoader=t}async loadAll(){const t=Object.values(j).map(e=>`${e}.png`);await this.spriteLoader.preloadUIAssets(t)}get(t){const e=j[t];return e===void 0?null:this.spriteLoader.getUIAsset(`${e}.png`)}getAssetMap(){return j}}const $t=18,kt=0,rt=60,Ht=5,xt=10,Lt=50,nt=46,at=130,Gt=12;class Ut{constructor(t,e,s,i,o,r){this.openedMainIndex=0,this.locationX=t,this.locationY=e,this.uiAssets=s,this.hitRegions=i,this.eventBus=o,this.localization=r,this.openedIndexes=P.map(()=>0)}showMenuIndex(t,e){if(t!==void 0&&(this.openedMainIndex=Math.max(0,Math.min(t,P.length-1))),e!==void 0){const s=P[this.openedMainIndex].items.length-1;this.openedIndexes[this.openedMainIndex]=Math.max(0,Math.min(e,s))}}getMenuMainOpenedIndex(){return this.openedMainIndex}getMenuSubOpenedIndex(){return this.openedIndexes[this.openedMainIndex]}getSelectedSetType(){const t=P[this.openedMainIndex],e=this.openedIndexes[this.openedMainIndex];return t.items[e]}draw(t){this.hitRegions.removeByPrefix("mainmenu_");for(let e=0;e<P.length;e++){const s=P[e],i=this.locationX+$t+e*(rt+Ht),o=this.locationY+kt,r=e===this.openedMainIndex,c=r?"mainMenuMainSelectedBg":"mainMenuMainUnselectedBg",a=this.uiAssets.get(c);a&&t.drawImage(a,i,o);const h=r?"Selected":"Unselected",l=this.uiAssets.get(`mainMenuMain_${s.id}_${h}`);l&&t.drawImage(l,i+12,o+5);const n=e;this.hitRegions.add({id:`mainmenu_main_${e}`,x:i,y:o,width:rt,height:a?a.height:40,cursor:"pointer",onClick:()=>this.mainItemClicked(n)})}this.drawSubMenu(t)}drawSubMenu(t){const e=P[this.openedMainIndex],s=e.items,i=e.type==="gender",o=this.locationY+Lt,r=i?at:nt,c=i?35:40,a=this.openedIndexes[this.openedMainIndex],h=3,l=291,n=6;t.beginPath(),t.moveTo(h+n,o),t.lineTo(h+l-n,o),t.arcTo(h+l,o,h+l,o+n,n),t.lineTo(h+l,o+c-n),t.arcTo(h+l,o+c,h+l-n,o+c,n),t.lineTo(h+n,o+c),t.arcTo(h,o+c,h,o+c-n,n),t.lineTo(h,o+n),t.arcTo(h,o,h+n,o,n),t.closePath(),t.fillStyle="#E5E3E1",t.fill();for(let d=0;d<s.length;d++){const u=s[d],g=this.locationX+xt+d*(r+Gt),p=d===a;if(i){if(p){const b=this.uiAssets.get("mainMenuSubGenderSelectedBg");b&&t.drawImage(b,g,o)}const I=this.uiAssets.get(`mainMenuSub_${u}`);I&&t.drawImage(I,g+5,o);const w=u==="male"?this.localization.boy:this.localization.girl;t.save(),t.font="bold 12px Verdana",t.fillStyle="#000000",t.textBaseline="middle";const m=g+(I?I.width+10:50),f=o+17;t.fillText(w,m,f),t.restore(),this.hitRegions.add({id:`mainmenu_sub_${d}`,x:g,y:o,width:at,height:35,cursor:"pointer",onClick:()=>this.subItemClicked(d,u)})}else{if(p){const w=this.uiAssets.get("mainMenuSubSelectedBg");w&&t.drawImage(w,g,o)}const I=this.uiAssets.get(`mainMenuSub_${u}`);I&&t.drawImage(I,g+5,o),this.hitRegions.add({id:`mainmenu_sub_${d}`,x:g,y:o,width:nt,height:40,cursor:"pointer",onClick:()=>this.subItemClicked(d,u)})}}}mainItemClicked(t){this.openedMainIndex=t;const e=this.openedIndexes[this.openedMainIndex],s=P[this.openedMainIndex].items[e];this.eventBus.emit("setTypeSelected",{setType:s})}subItemClicked(t,e){this.openedIndexes[this.openedMainIndex]=t,this.eventBus.emit("setTypeSelected",{setType:e})}}const lt=5,Xt=3,ct=9,A=45;class Yt{constructor(t,e,s,i,o,r,c){this.currentSetType="hd",this.currentGender="M",this.currentColor="FFFFFF",this.currentSelectedId=0,this.setIsMandatory=!0,this.pageData=[],this.currentPageIndex=0,this.currentSelectionPageNo=0,this.previewCache=new Map,this.locationX=t,this.locationY=e,this.useClub=s,this.uiAssets=i,this.hitRegions=o,this.eventBus=r,this.previewRenderer=c}showMenu(t,e,s,i,o){this.currentSetType=t,this.currentGender=e,this.currentColor=s||"FDFDFD",this.currentSelectedId=i||0,this.setIsMandatory=o??!0,this.previewCache.clear(),this.currentSelectedId===0&&(this.currentSelectionPageNo=0);const r=C.getInstance().getSetsForSetType(this.currentSetType,this.currentGender,this.useClub,!0);this.pageData=[];let c=0,a=[];const h=lt*Xt;let l=0,n=0;for(;n<r.length;)c===0&&n===0?this.setIsMandatory||(a.push({type:"remove"}),l++):l===0&&c>0&&(a.push({type:"back"}),l++),l===h-1&&n<r.length?(a.push({type:"forward"}),l++):(r[n].getSetId()===i&&(this.currentSelectionPageNo=c),a.push({type:"part",index:n}),n++,l++),n===r.length?this.pageData.push(a):l===h&&(this.pageData.push(a),l=0,a=[],c++);r.length===0&&!this.setIsMandatory&&(this.pageData=[[{type:"remove"}]]),this.currentPageIndex=this.currentSelectionPageNo}setColor(t){this.currentColor=t,this.previewCache.clear()}setSelection(t){this.currentSelectedId=t}clearSelection(){this.currentSelectedId=0}getCurrentSetType(){return this.currentSetType}draw(t){if(this.hitRegions.removeByPrefix("bodypart_"),this.pageData.length===0)return;const e=Math.max(0,Math.min(this.currentPageIndex,this.pageData.length-1)),s=this.pageData[e];if(!s)return;const i=C.getInstance().getSetsForSetType(this.currentSetType,this.currentGender,this.useClub,!0);let o=0,r=0;for(let c=0;c<s.length;c++){const a=this.locationX+o*(A+ct),h=this.locationY+r*(A+ct),l=s[c];if(l.type==="part"&&l.index!==void 0){const n=i[l.index];if(!n){o++;continue}const u=n.getSetId()===this.currentSelectedId;this.drawPartItem(t,n,a,h,u),this.hitRegions.add({id:`bodypart_${c}`,x:a,y:h,width:A,height:A,cursor:"pointer",onClick:()=>{this.eventBus.emit("setSelected",{setId:n.getSetId(),setType:this.currentSetType})}})}else l.type==="remove"?(this.drawRemoveItem(t,a,h,this.currentSelectedId===0),this.hitRegions.add({id:"bodypart_remove",x:a,y:h,width:A,height:A,cursor:"pointer",onClick:()=>{this.eventBus.emit("setSelected",{setId:0,setType:this.currentSetType})}})):l.type==="forward"?(this.drawArrow(t,"Right",a,h),this.hitRegions.add({id:"bodypart_forward",x:a,y:h,width:A,height:A,cursor:"pointer",onClick:()=>{this.currentPageIndex++,this.eventBus.emit("stateChanged")}})):l.type==="back"&&(this.drawArrow(t,"Left",a,h),this.hitRegions.add({id:"bodypart_back",x:a,y:h,width:A,height:A,cursor:"pointer",onClick:()=>{this.currentPageIndex--,this.eventBus.emit("stateChanged")}}));o++,o>=lt&&(o=0,r++)}}drawPartItem(t,e,s,i,o){const r=e.getSetId();if(!this.previewCache.has(r)){const a=this.previewRenderer.renderIcon(e,this.currentColor);this.previewCache.set(r,a)}const c=this.previewCache.get(r);if(t.save(),t.beginPath(),t.rect(s,i,A,A),t.clip(),t.drawImage(c,s,i),t.restore(),o){const a=this.uiAssets.get("partSelected");a&&t.drawImage(a,s-1,i-1)}if(e.isClubOnly()){const a=this.uiAssets.get("hcTagSmall");a&&t.drawImage(a,s+41,i+25)}}drawRemoveItem(t,e,s,i){const o=this.uiAssets.get("partRemove");if(o&&t.drawImage(o,e+10,s-5),i){const r=this.uiAssets.get("partSelected");r&&t.drawImage(r,e-1,s-1)}}drawArrow(t,e,s,i){const o=e==="Right"?"partArrowRight":"partArrowLeft",r=this.uiAssets.get(o);r&&t.drawImage(r,s,i)}}const G=27,U=27,zt=3,qt=2,ht=9,Wt=4,X=3;class Vt{constructor(t,e,s,i,o){this.currentSelectedId=0,this.targetSetType="hd",this.showClubColors=!1,this.currentPaletteId=1,this.pageData=[],this.currentPageIndex=0,this.currentSelectionPageNo=0,this.locationX=t,this.locationY=e,this.uiAssets=s,this.hitRegions=i,this.eventBus=o}showColorChooser(t,e,s,i){this.currentSelectedId=e||0,this.targetSetType=s,this.showClubColors=i??!1,this.currentPaletteId=t,this.currentSelectionPageNo=0;const o=C.getInstance().getColorsForPaletteId(this.currentPaletteId,this.showClubColors,!0);this.pageData=[];let r=[],c=0;const a=ht*Wt;let h=0,l=0;for(;l<o.length;)h===0&&c>0&&(r.push({type:"back"}),h++),h===a-1&&l<o.length-1?(r.push({type:"forward"}),h++):(o[l].getID()===this.currentSelectedId&&(this.currentSelectionPageNo=c),r.push({type:"color",index:l}),l++,h++),l===o.length?this.pageData.push(r):h===a&&(this.pageData.push(r),h=0,r=[],c++);this.currentPageIndex=this.currentSelectionPageNo}getCurrentSelectedColorId(){return this.currentSelectedId}draw(t){if(this.hitRegions.removeByPrefix("color_"),this.pageData.length===0)return;const e=Math.max(0,Math.min(this.currentPageIndex,this.pageData.length-1)),s=this.pageData[e];if(!s)return;const i=C.getInstance().getColorsForPaletteId(this.currentPaletteId,this.showClubColors,!0);let o=0,r=0;for(let c=0;c<s.length;c++){const a=this.locationX+o*(G+zt),h=this.locationY+r*(U+qt),l=s[c];if(l.type==="color"&&l.index!==void 0){const n=i[l.index];if(!n){o++;continue}const d=n.getID()===this.currentSelectedId;this.drawColorButton(t,n,a,h,d);const u=n.getID(),g=n.getColorStr();this.hitRegions.add({id:`color_${c}`,x:a,y:h,width:G,height:U,cursor:"pointer",onClick:()=>{this.currentSelectedId=u,this.eventBus.emit("colorSelected",{colorStr:g,targetSetType:this.targetSetType,colorId:u})}})}else l.type==="forward"?(this.drawSmallArrow(t,"Right",a,h),this.hitRegions.add({id:"color_forward",x:a,y:h,width:G,height:U,cursor:"pointer",onClick:()=>{this.currentPageIndex++,this.eventBus.emit("stateChanged")}})):l.type==="back"&&(this.drawSmallArrow(t,"Left",a,h),this.hitRegions.add({id:"color_back",x:a,y:h,width:G,height:U,cursor:"pointer",onClick:()=>{this.currentPageIndex--,this.eventBus.emit("stateChanged")}}));o++,o>=ht&&(o=0,r++)}}drawColorButton(t,e,s,i,o){const r=e.getColorStr(),[c,a,h]=V(r),l=this.uiAssets.get("colorBg");if(l){const n=document.createElement("canvas");n.width=l.width,n.height=l.height;const d=n.getContext("2d");d.drawImage(l,0,0);const u=d.getImageData(0,0,l.width,l.height),g=u.data,p=c/255,I=a/255,w=h/255;for(let m=0;m<g.length;m+=4)g[m]=Math.round(g[m]*p),g[m+1]=Math.round(g[m+1]*I),g[m+2]=Math.round(g[m+2]*w);d.putImageData(u,0,0),t.drawImage(n,s+X,i+X)}else t.fillStyle=`#${r}`,t.fillRect(s+X,i+X,21,21);if(e.isClubOnly()){const n=this.uiAssets.get("hcTagSmall");n&&t.drawImage(n,s+1,i+1)}if(o){const n=this.uiAssets.get("colorSelect");n&&t.drawImage(n,s,i)}}drawSmallArrow(t,e,s,i){const o=e==="Right"?"arrowSmallRight":"arrowSmallLeft",r=this.uiAssets.get(o);r&&t.drawImage(r,s,i)}}class jt{constructor(t,e,s,i,o,r){this.uiAssets=t,this.hitRegions=e,this.eventBus=s,this.avatarRenderer=i,this.figure=o,this.direction=r}setFigure(t){this.figure=t}setDirection(t){this.direction=t}getDirection(){return this.direction}rotateNext(){this.direction--,this.direction<0&&(this.direction=7)}rotatePrev(){this.direction++,this.direction>7&&(this.direction=0)}draw(t){this.hitRegions.removeByPrefix("avatar_");const e=this.uiAssets.get("floorTile");e&&t.drawImage(e,k+5,q+165),this.avatarRenderer.drawAvatarToCanvas(t,this.figure,this.direction,k,q,st);const s=this.uiAssets.get("rotateArrowLeft"),i=this.uiAssets.get("rotateArrowRight"),o=q+100;if(s){const r=k-20;t.drawImage(s,r,o),this.hitRegions.add({id:"avatar_rotateLeft",x:r,y:o,width:s.width,height:s.height,cursor:"pointer",onClick:()=>{this.rotateNext(),this.eventBus.emit("stateChanged")}})}if(i){const r=k+128+10;t.drawImage(i,r,o),this.hitRegions.add({id:"avatar_rotateRight",x:r,y:o,width:i.width,height:i.height,cursor:"pointer",onClick:()=>{this.rotatePrev(),this.eventBus.emit("stateChanged")}})}}}const Z=46,Zt=1e3;class Jt{constructor(t,e,s,i){this.enabled=!0,this.cooldownTimer=null,this.clouds=[],this.cloudAnimationEnd=0,this.animating=!1,this.uiAssets=t,this.hitRegions=e,this.eventBus=s,this.localization=i}draw(t){this.hitRegions.removeByPrefix("randomize_");const e=this.uiAssets.get("randomizeButtonBg");if(e){const s=k+$*st/2,i=Math.round(s-e.width/2);t.drawImage(e,i,Z),t.save(),t.font="bold 11px Verdana",t.fillStyle="#000000",t.textAlign="center",t.textBaseline="middle",t.fillText(this.localization.randomize,i+e.width/2,Z+e.height/2),t.restore(),this.hitRegions.add({id:"randomize_btn",x:i,y:Z,width:e.width,height:e.height,cursor:this.enabled?"pointer":"default",onClick:()=>this.handleClick()})}}drawClouds(t){if(!this.animating)return;const e=Date.now();if(e>=this.cloudAnimationEnd){this.animating=!1,this.clouds=[];return}e-(this.cloudAnimationEnd-700)<350&&Math.random()<.3&&this.clouds.push({x:325+Math.random()*80,y:85+Math.random()*180,alpha:1,startTime:e,scale:.5+Math.random()*1.5});const i=this.uiAssets.get("cloudAnimation");t.save(),t.imageSmoothingEnabled=!1;for(const o of this.clouds){const r=e-o.startTime,c=Math.max(0,1-r/500);if(!(c<=0))if(t.globalAlpha=c,i){const a=i.width*o.scale,h=i.height*o.scale;t.drawImage(i,o.x,o.y,a,h)}else t.fillStyle="#FFFFFF",t.beginPath(),t.arc(o.x+10,o.y+10,10*o.scale,0,Math.PI*2),t.fill()}t.restore()}isAnimating(){return this.animating}handleClick(){this.enabled&&(this.enabled=!1,this.cooldownTimer=window.setTimeout(()=>{this.enabled=!0,this.cooldownTimer=null},Zt),this.animating=!0,this.cloudAnimationEnd=Date.now()+700,this.clouds=[],this.eventBus.emit("randomizeAvatar"))}}const Kt=5e3;class Qt{constructor(){this.initBlockActive=!0,this.editorOkToProceed=!0,this.initBlockTimer=null,this.initBlockTimer=window.setTimeout(()=>{this.initBlockActive=!1,this.setAllowedToProceed(this.editorOkToProceed)},Kt)}setGenderAndFigure(t,e){var s,i;try{(i=(s=window.HabboEditor)==null?void 0:s.setGenderAndFigure)==null||i.call(s,t,e)}catch(o){console.warn("HabboEditor.setGenderAndFigure failed:",o)}}setAllowedToProceed(t){var e,s;if(this.editorOkToProceed=t,!this.initBlockActive)try{(s=(e=window.HabboEditor)==null?void 0:e.setAllowedToProceed)==null||s.call(e,t)}catch(i){console.warn("HabboEditor.setAllowedToProceed failed:",i)}}setEditorState(t){var e,s;try{(s=(e=window.HabboEditor)==null?void 0:e.setEditorState)==null||s.call(e,t)}catch(i){console.warn("HabboEditor.setEditorState failed:",i)}}showHabboClubNotice(){var t,e;try{(e=(t=window.HabboEditor)==null?void 0:t.showHabboClubNotice)==null||e.call(t)}catch(s){console.warn("HabboEditor.showHabboClubNotice failed:",s)}}hideHabboClubNotice(){var t,e;try{(e=(t=window.HabboEditor)==null?void 0:t.hideHabboClubNotice)==null||e.call(t)}catch(s){console.warn("HabboEditor.hideHabboClubNotice failed:",s)}}showOldFigureNotice(){var t,e;try{(e=(t=window.HabboEditor)==null?void 0:t.showOldFigureNotice)==null||e.call(t)}catch(s){console.warn("HabboEditor.showOldFigureNotice failed:",s)}}destroy(){this.initBlockTimer!==null&&clearTimeout(this.initBlockTimer)}}class J{constructor(t,e){this.config={...ft,...e},this.container=t,this.hitRegions=new Ot,this.state=new Ft(this.config.userHasClub,this.config.showClubSelections),this.spriteLoader=new Tt(this.config.assetsPath),this.avatarRenderer=new Mt(this.spriteLoader),this.previewIconRenderer=new Bt(this.spriteLoader),this.bridge=new Qt,this.init()}async init(){const t=this.config.assetsPath,e=t+(t.endsWith("/")?"":"/")+"data/";await Promise.all([C.getInstance().loadFromUrl(e+"figuredata.xml"),H.getInstance().loadFromUrl(e+"draworder.xml"),_.getInstance().loadFromUrl(e+"symbols.csv"),_.getInstance().loadOffsetsFromUrl(e+"spriteoffsets.csv")]);const s=_.getInstance(),i=s.getAllNames().map(r=>s.getFilenameForName(r)).filter(Boolean);await this.spriteLoader.preloadAllSprites(i),console.log(`[HabboEditor] Loaded ${i.length} avatar sprites`),this.uiAssets=new Nt(this.spriteLoader),await this.uiAssets.loadAll(),console.log("[HabboEditor] UI assets loaded"),this.initFigure(),console.log(`[HabboEditor] Figure: ${this.state.figure.getFigureString()} gender=${this.state.figure.getGender()}`),this.createUI(),this.canvasManager.setDrawCallback(()=>this.drawAll()),this.canvasManager.startContinuousRender(),this.bridge.setGenderAndFigure(this.state.figure.getGender(),this.state.figure.getFigureString()),this.checkClubSetsStatus()&&this.bridge.setAllowedToProceed(!1),this.config.menuState&&this.updatePartAndColorMenu(this.config.menuState)}initFigure(){const t=this.config.figure,e=this.config.gender;if(!t||!e||t===""||e===""){const s=!e||e===""?"U":e;this.state.figure=new B,this.state.figure.randomizeFigure(s,this.config.userHasClub&&this.config.showClubSelections)}else this.state.figure=new B(e),this.state.figure.parseFigureString(t)||this.bridge.showOldFigureNotice();this.state.storedFemaleFigure=new B("F"),this.state.storedMaleFigure=new B("M")}createUI(){this.canvasManager=new Et(this.container,this.hitRegions),this.mainMenu=new Ut(0,0,this.uiAssets,this.hitRegions,this.state.eventBus,this.config.localization);const t=this.state.figure.getGender()==="F"?1:0;this.mainMenu.showMenuIndex(0,t),this.bodyPartMenu=new Yt(18,100,this.config.showClubSelections,this.uiAssets,this.hitRegions,this.state.eventBus,this.previewIconRenderer),this.initBodyPartMenu();const s=100+3*45+2*9+6+4+9;this.colorChooser=new Vt(18,s,this.uiAssets,this.hitRegions,this.state.eventBus),this.initColorChooser(),this.avatarDisplay=new jt(this.uiAssets,this.hitRegions,this.state.eventBus,this.avatarRenderer,this.state.figure,this.state.avatarDirection),this.randomizeButton=new Jt(this.uiAssets,this.hitRegions,this.state.eventBus,this.config.localization),this.wireEvents()}initBodyPartMenu(){const t=C.getInstance(),e=this.state.figure.getSetTypeColorId(v),s=t.getColorData(e),i=s?s.getColorStr():"FFFFFF",o=this.state.figure.getSetItemByType(v),r=o?o.getSetId():0,c=t.isSetTypeMandatory(v);this.bodyPartMenu.showMenu(v,this.state.figure.getGender(),i,r,c)}initColorChooser(){const e=C.getInstance().getPaletteIdForSetType(v),s=this.state.figure.getSetTypeColorId(v);this.colorChooser.showColorChooser(e,s,v,this.config.showClubSelections)}wireEvents(){const t=this.state.eventBus;t.on("setTypeSelected",e=>{this.handleSetTypeSelection(e)}),t.on("setSelected",e=>{this.handleSetSelection(e)}),t.on("colorSelected",e=>{this.handleColorSelection(e)}),t.on("randomizeAvatar",()=>{this.handleRandomize()}),t.on("stateChanged",()=>{this.canvasManager.requestRedraw()})}handleSetTypeSelection(t){let e=t.setType;const s=this.state.figure.getGender();let i=s;if((e==="male"||e==="female")&&(i=e==="male"?"M":"F",e="hd"),s!==i){const l=this.state.figure.getFigureString();i==="M"?(this.state.storedFemaleFigure.parseFigureString(l),this.state.figure.setGender(i),this.state.figure.parseFigureString(this.state.storedMaleFigure.getFigureString())):(this.state.storedMaleFigure.parseFigureString(l),this.state.figure.setGender(i),this.state.figure.parseFigureString(this.state.storedFemaleFigure.getFigureString())),this.state.figure.getFigureString().length===0&&(this.state.figure.randomizeFigure(i,this.config.userHasClub&&this.config.showClubSelections),this.checkClubSetsStatus()),this.bridge.setGenderAndFigure(this.state.figure.getGender(),this.state.figure.getFigureString()),this.bridge.setAllowedToProceed(!0)}this.state.currentSetType=e;const o=C.getInstance(),r=o.isSetTypeMandatory(e),c=o.getPaletteIdForSetType(e),a=this.state.figure.getSetItemByType(e);if(a){const l=a.getSetId(),n=a.getColorId(),d=o.getColorData(n),u=d?d.getColorStr():"FFFFFF";this.colorChooser.showColorChooser(c,n,e,this.config.showClubSelections),this.bodyPartMenu.showMenu(e,i,u,l,r)}else{const l=o.getColorsForPaletteId(c,this.config.userHasClub,!0),n=l.length>0?l[0].getID():0,d=l.length>0?l[0].getColorStr():"FFFFFF";this.colorChooser.showColorChooser(c,n,e,this.config.showClubSelections),this.bodyPartMenu.showMenu(e,i,d,0,r)}this.avatarDisplay.setFigure(this.state.figure);const h=`${e}-${this.mainMenu.getMenuMainOpenedIndex()}-${this.mainMenu.getMenuSubOpenedIndex()}`;this.bridge.setEditorState(h),this.canvasManager.requestRedraw()}handleSetSelection(t){const e=C.getInstance(),s=t.setType;let i=t.setId,o=!0;const r=e.getPaletteIdForSetType(s);let c=this.state.figure.getSetTypeColorId(s);if((c===void 0||c===-1)&&(c=this.colorChooser.getCurrentSelectedColorId()),c===void 0||c===-1){const n=e.getColorsForPaletteId(r);n.length>0&&(c=n[0].getID(),this.colorChooser.showColorChooser(r,c,s,this.config.showClubSelections))}const a=e.getColorData(c),h=a?a.getColorStr():"FFFFFF",l=this.state.figure.getSetItemByType(s);l&&i===l.getSetId()&&(e.isSetTypeMandatory(s)||(i=0,o=!1,this.bodyPartMenu.clearSelection())),i===0?this.state.figure.removeSetItemByType(s):this.state.figure.setSetItem(s,i,c),o&&(this.bodyPartMenu.setSelection(i),this.bodyPartMenu.setColor(h)),this.bridge.setGenderAndFigure(this.state.figure.getGender(),this.state.figure.getFigureString()),this.avatarDisplay.setFigure(this.state.figure),this.checkClubSetsStatus(),this.canvasManager.requestRedraw()}handleColorSelection(t){const e=t.colorStr,s=t.targetSetType,i=t.colorId;this.bodyPartMenu.setColor(e),this.state.figure.setSetTypeColor(s,i),this.bridge.setGenderAndFigure(this.state.figure.getGender(),this.state.figure.getFigureString()),this.avatarDisplay.setFigure(this.state.figure),this.checkClubSetsStatus(),this.canvasManager.requestRedraw()}handleRandomize(){this.state.figure.randomizeFigure(this.state.figure.getGender(),this.config.userHasClub&&this.config.showClubSelections),this.bridge.setGenderAndFigure(this.state.figure.getGender(),this.state.figure.getFigureString()),this.avatarDisplay.setFigure(this.state.figure),this.updatePartAndColorMenu(),this.canvasManager.requestRedraw()}updatePartAndColorMenu(t){const e=C.getInstance();let s=this.bodyPartMenu.getCurrentSetType();if(t){const n=t.split("-"),d=n[0],u=parseInt(n[1],10),g=parseInt(n[2],10);this.mainMenu.showMenuIndex(u,g);const p=e.getSetTypes();for(const[I]of p)if(I===d){s=d;break}}const i=this.state.figure.getGender(),o=e.isSetTypeMandatory(s),r=e.getPaletteIdForSetType(s),c=this.state.figure.getSetItemByType(s);let a,h,l;if(c){a=c.getSetId(),h=c.getColorId();const n=e.getColorData(h);l=n?n.getColorStr():"FFFFFF"}else{a=0;const n=e.getColorsForPaletteId(r,this.config.userHasClub,!0);h=n.length>0?n[0].getID():0,l=n.length>0?n[0].getColorStr():"FFFFFF"}this.colorChooser.showColorChooser(r,h,s,this.config.showClubSelections),this.bodyPartMenu.showMenu(s,i,l,a,o),this.checkClubSetsStatus(),this.avatarDisplay.setFigure(this.state.figure)}checkClubSetsStatus(){return this.state.figure.getClubSets().length>0&&!this.config.userHasClub?(this.bridge.setAllowedToProceed(!1),this.bridge.showHabboClubNotice(),!1):this.state.figure.getClubColors().length>0&&!this.config.userHasClub?(this.bridge.setAllowedToProceed(!1),this.bridge.showHabboClubNotice(),!1):(this.bridge.setAllowedToProceed(!0),this.bridge.hideHabboClubNotice(),!0)}drawBorders(t){t.beginPath(),t.moveTo(11,47),t.lineTo(286,47),t.arcTo(294,47,294,55,8),t.lineTo(294,251),t.arcTo(294,259,286,259,8),t.lineTo(11,259),t.arcTo(3,259,3,251,8),t.lineTo(3,55),t.arcTo(3,47,11,47,8),t.closePath(),t.strokeStyle="#FFCC00",t.lineWidth=3,t.stroke();const f=3,b=291,F=272,M=4*27+3*2,R=F-9,T=9+M+9,y=R;t.beginPath(),t.moveTo(128,y),t.lineTo(140,y-8),t.lineTo(152,y),t.closePath(),t.fillStyle="#FFFFFF",t.fill(),t.beginPath(),t.moveTo(f+8,y),t.lineTo(128,y),t.lineTo(140,y-8),t.lineTo(152,y),t.lineTo(f+b-8,y),t.arcTo(f+b,y,f+b,y+8,8),t.lineTo(f+b,y+T-8),t.arcTo(f+b,y+T,f+b-8,y+T,8),t.lineTo(f+8,y+T),t.arcTo(f,y+T,f,y+T-8,8),t.lineTo(f,y+8),t.arcTo(f,y,f+8,y,8),t.closePath(),t.strokeStyle="#000000",t.lineWidth=2,t.stroke()}drawAll(){const t=this.canvasManager.ctx;this.drawBorders(t),this.avatarDisplay.draw(t),this.randomizeButton.draw(t),this.mainMenu.draw(t),this.bodyPartMenu.draw(t),this.colorChooser.draw(t),this.randomizeButton.drawClouds(t)}getFigureString(){return this.state.figure.getFigureString()}getGender(){return this.state.figure.getGender()}}window.HabboAvatarEditor=J;const dt=document.getElementById("editor-container");dt&&new J(dt,{figure:"hd-180-1.ch-215-82.lg-270-82",gender:"M",userHasClub:!1,showClubSelections:!0,assetsPath:""}),et.HabboAvatarEditor=J,Object.defineProperty(et,Symbol.toStringTag,{value:"Module"})})(this.HabboAvatarEditor=this.HabboAvatarEditor||{});
